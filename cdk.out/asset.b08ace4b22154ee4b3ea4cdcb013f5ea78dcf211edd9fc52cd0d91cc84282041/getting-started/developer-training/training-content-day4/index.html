<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper docs-doc-page docs-version-2022.3 plugin-docs plugin-id-default docs-doc-id-getting-started/developer-training/training-content-day4">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Developer training - Day four | Low-code Platform For Financial Markets</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://genesis.global//getting-started/developer-training/training-content-day4/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="2022.3"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2022.3"><meta data-rh="true" name="docsearch:version" content="2022.3"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2022.3"><meta data-rh="true" property="og:title" content="Developer training - Day four | Low-code Platform For Financial Markets"><meta data-rh="true" name="description" content="Day three recap"><meta data-rh="true" property="og:description" content="Day three recap"><meta data-rh="true" name="keywords" content="getting started,quick start,developer training,day four"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://genesis.global//getting-started/developer-training/training-content-day4/"><link data-rh="true" rel="alternate" href="https://genesis.global//getting-started/developer-training/training-content-day4/" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://genesis.global//getting-started/developer-training/training-content-day4/" hreflang="x-default"><!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-5GTR43J",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager -->



<script src="/js/docs.iife.min.js" async></script><link rel="stylesheet" href="/assets/css/styles.b91eddbd.css">
<link rel="preload" href="/assets/js/runtime~main.1e787288.js" as="script">
<link rel="preload" href="/assets/js/main.d2eb593c.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/getting-started/"><div class="navbar__logo"><img src="/img/logo-icon--light.svg" alt="Genesis Documentation" class="themedImage_ToTc themedImage--light_HNdA" height="25" width="25"><img src="/img/logo-icon--light.svg" alt="Genesis Documentation" class="themedImage_ToTc themedImage--dark_i4oU" height="25" width="25"></div><b class="navbar__title text--truncate">DOCUMENTATION</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/getting-started/">Learning</a><a class="navbar__item navbar__link" href="/database/">Database</a><a class="navbar__item navbar__link" href="/server/">Server</a><a class="navbar__item navbar__link" href="/web/">Web</a><a class="navbar__item navbar__link" href="/operations/">Operations</a><a class="navbar__item navbar__link" href="/fuse/">Early access</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link so-icon" aria-label="StackOverflow" href="/resource/stackoverflow-onboarding/"></a><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-2022.3"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/getting-started/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/getting-started/learn-the-basics/what-can-i-build/build-intro/">LEARN THE BASICS</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed menu__nested-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/getting-started/learn-the-basics/what-can-i-build/build-intro/">What can I build?</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/learn-the-basics/simple-introduction/">Simple introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/learn-the-basics/creation-process/">The creation process</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed menu__nested-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/getting-started/learn-the-basics/data-model/">Data model</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data model&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/learn-the-basics/building-the-database/">Building the database</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed menu__nested-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/getting-started/learn-the-basics/modules/inside-a-data-server/">Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/getting-started/learn-the-basics/Components/introduction/">Components</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed menu__nested-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/getting-started/learn-the-basics/key-system-files/process/">Key System Files</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed menu__nested-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/getting-started/learn-the-basics/front-end-basics/add-a-new-page/">Front-end basics</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/learn-the-basics/next-steps/">Next steps</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed menu__nested-category"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/getting-started/learn-the-basics/running-the-server/build/">Running the server</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/quick-start/hardware-and-software/">QUICK START</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/go-to-the-next-level/introduction/">GO TO THE NEXT LEVEL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/prerequisites/introduction/">PRE-REQUISITES</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/use-cases/faster_quick-start/">USE CASES</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/getting-started/developer-training/training-intro/">DEVELOPER TRAINING</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/developer-training/training-intro/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/developer-training/fundamentals/">Fundamentals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/developer-training/environment-setup/">Environment setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/developer-training/training-content-day1/">Day one</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/developer-training/training-content-day2/">Day two</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/developer-training/training-content-day3/">Day three</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/getting-started/developer-training/training-content-day4/">Day four</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/developer-training/training-content-day5/">Day five</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/server_training/ssdt-intro/">Server Specialist Developer Training</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/web-training/training-intro/">Web Developer Training</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/glossary/glossary/">GlOSSARY</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2022.3</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Developer training - Day four</h1></header><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Day three recap</summary><div><div class="collapsibleContent_i85q"><div><div>Here are the main takeaways from <a href="/getting-started/developer-training/training-content-day3/">Day three</a>.</div><li>We introduced <a href="/getting-started/developer-training/training-content-day3/#views">Views</a> and how you can use them.</li><li>We extended our application adding <a href="/getting-started/developer-training/training-content-day3/#extending-trade-and-adding-position-table">Position</a> table.</li><li>We started writing some <a href="/getting-started/developer-training/training-content-day3/#automated-testing">automated tests</a> for our application.</li><li>We added <a href="/getting-started/developer-training/training-content-day3/#calculated-data">calculated data (derived fields)</a> into our main View.</li><li><a href="/getting-started/developer-training/training-content-day3/#consolidators">Consolidators</a> perform data aggregation and calculations, and here we created one to real-time feed the Positions table.</li><li>We added a <a href="/getting-started/developer-training/training-content-day3/#ui-configuring">grid</a> in the UI to display the Positions using Grid Pro, with more flexibility to customize the HTML and CSS.</li></div></div></div></details><p>This day covers:</p><ul><li><a href="#state-management">State management​</a></li><li><a href="#adding-logic-to-the-event-handler">Adding logic to the event handler</a></li><li><a href="#auditing">Auditing​</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="state-management">State management​<a class="hash-link" href="#state-management" title="Direct link to heading">​</a></h2><p>State machines enable you to control workflow by defining the transitions from state to state. This example enables you to build a very simple state machine so that you can add new trades. You will create a new field called TRADE_STATUS, which can have three possible states: NEW, ALLOCATED, CANCELLED.</p><ul><li>NEW can go to ALLOCATED or CANCELLED.</li><li>ALLOCATED and CANCELLED can’t go anywhere else.</li><li>NEW is the only state you can use to insert new records.</li></ul><p><img loading="lazy" src="data:image/png;base64,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948AjLV///6lS5dee+21klt//Qojp8JZWVnLly8/ePCgfwVcMDKcHOfOnZO3hzI7Bw0a5E/YMDKh77777g0bNpSVlflXAADznD59esuWLXPmzLn44ov99StMenr63LlzP/jggzNnzvhXwAUjw0lTVVX1zjvvXHPNNa1bt/bnbJB82a1bt4ULFx47dswfCgCmqqioWLlyZe/evaOXsv79+69evbqystIfimQgw8m0Z8+e2bNn9+vX76KLLgpNXGnwuHHjXn75ZTlj9scBgKlqa2vljGLKlCk9evRo06aNt5SlpaX17Nnzjjvu2Lx5sz8OSUKGk+nIkSN/+tOfpk2b1rVr19DcveKKK5YuXbpt2zZ+OAuA+STDe/fu9X43qV27dt5S1r59+5tuuul3v/vd559/7o9DkpDhZKqurj5w4MCyZctCP6jVtm3bW265ZcuWLeXl5f4gADBbZWXlrl27Zs2aFfpgr2PHjg899NCePXv4RDrpyHCSnTt37tVXXx01apS8i2zdunX37t3nzJlz+PBhfzcA2OD06dO//vWv+/Tp06ZNm7S0tAEDBjz77LP800MqkOEkkxPijz/+eO7cuUOGDOnWrdttt922Zs2akydP+rsBwAZS3PXr18+YMePSSy+97LLL7r///jfeeIMfcFEhfob5PdfmOnXq1ObNm3Nzc2+66aaVK1f+73//4598axamHFRgXjWLPFylpaWvvfbaD37wg6lTp65bt66srIzHsFkSfLgSOhuWihw7duzgwYMHEI88SiUlJcXFxb/61a9mz579j3/8Q7786quv/N2IzXvo5D04L3UoUllZKWlhKUuE93r86KOPHn300Z/97GeffPKJfMlDlwh5lOQtS1VVVTIzLBP3mWeeufPOO3/4wx/egXjkgZI/R40aNXDgwEmTJt11113yXtLbhSbI7Hr44Yffe+89PjyACrImfvrpp/PmzfMmmzfrEIusWrJ2ZWdnDx06dPjw4VOmTPFWNjQhNK8WLVq0b9++ZGZ4z549kydPbteuXb9+/b797W9fjiaNGDFC/rziiiu+853vjBw50vsSTfAepU6dOqWnp7/44ot8/wkqyJr4xhtvDBs2rGPHjpmZmTLr/PmHxshL0lu7ZB1jKUuQ9HHw4MHSSln/t2zZkswMf/bZZxMmTJCJu2rVqvfff//dd9/djCbJQ/Sf//xH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" width="642" height="431" class="img_ev3q"></p><p>Once we have added add a new field to the data model, we will edit the event handler file to add controlled transitions from one state to another.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-data-model">1. Data model<a class="hash-link" href="#1-data-model" title="Direct link to heading">​</a></h3><p>Make sure you added the TRADE_STATUS field to the TRADE table in the <strong>alpha-tables-dictionary.kts</strong> file.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">tables </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">table</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TRADE&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    TRADE_STATUS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    primaryKey </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      TRADE_ID</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the TRADE_STATUS is missing, run <a href="/getting-started/developer-training/training-content-day1/#generatefields">genesis-generated-fields</a> to generate the fields, AND​ <a href="/getting-started/developer-training/training-content-day1/#generatedao">genesis-generated-dao</a> to create the DAOs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-create-a-new-class-for-the-state-machine">2. Create a new class for the state machine<a class="hash-link" href="#2-create-a-new-class-for-the-state-machine" title="Direct link to heading">​</a></h3><p>Add a main folder in the event handler module <em>alpha-eventhandler</em> and create a state machine class called <em>TradeStateMachine</em> inside <strong>alpha-eventhandler/src/main/kotlin/global/genesis</strong>.</p><p>Add a state machine definition and assign a field in the <strong>onCommit</strong> block,</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">genesis</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> com</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">google</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">inject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Inject</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">genesis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">commons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">annotation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Module</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">genesis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">entity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">multi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">AsyncEntityDb</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">genesis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">statemachine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">StateMachine</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">genesis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">statemachine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Transition</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">genesis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">gen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Trade</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">genesis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">gen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dao</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">enums</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TradeStatus</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token annotation builtin" style="color:rgb(130, 170, 255)">@Module</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> TradeStateMachine </span><span class="token annotation builtin" style="color:rgb(130, 170, 255)">@Inject</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    db</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> AsyncEntityDb</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> internalState</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> StateMachine</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeEffect</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">stateMachineBuilder</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        readState </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> tradeStatus </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">NEW</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            isMutable </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">initialState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TradeEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                onValidate </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> trade </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">isTradeIdInitialised </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tradeId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">isNotEmpty</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        verify </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            db hasNoEntry Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ById</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tradeId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            onCommit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> trade </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">enteredBy </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TestUser&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">price </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">transition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ALLOCATED</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Allocated</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">transition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CANCELLED</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Cancelled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ALLOCATED</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            isMutable </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">transition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">NEW</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Cancelled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">transition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CANCELLED</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Cancelled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CANCELLED</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            isMutable </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">suspend</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fun</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">insert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Transition</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeEffect</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> internalState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">suspend</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fun</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">modify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tradeId</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> modify</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">suspend</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> Unit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Transition</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeEffect</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        internalState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">update</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ById</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tradeId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> _ </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">modify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">suspend</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fun</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">modify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Transition</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeEffect</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> internalState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">update</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">sealed</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> TradeEffect </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">object</span><span class="token plain"> New </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">TradeEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">object</span><span class="token plain"> Allocated </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">TradeEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">object</span><span class="token plain"> Cancelled </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">TradeEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-add-the-module-as-a-dependency-in-the-buildgradlekts-inside-alpha-script-config-module">3. Add the module as a dependency in the <em>build.gradle.kts</em> inside <strong>alpha-script-config</strong> module.<a class="hash-link" href="#3-add-the-module-as-a-dependency-in-the-buildgradlekts-inside-alpha-script-config-module" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">api(project(&quot;:alpha-eventhandler&quot;))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-edit-the-event-handler-to-add-an-integrated-state-machine">4. Edit the event handler to add an integrated state machine<a class="hash-link" href="#4-edit-the-event-handler-to-add-an-integrated-state-machine" title="Direct link to heading">​</a></h3><p>Let&#x27;s edit the event handler to add an integrated state machine. First, in the <strong>alpha-eventhandler.kts</strong> file, declare a variable to be visible to all events by injecting the class <code>TradeStateMachine</code> that we have just created. </p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">eventHandler </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> stateMachine </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> inject</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">TradeStateMachine</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    eventHandler</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Trade</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TRADE_INSERT&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> transactional </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, integrate the state machine in the TRADE_INSERT event <em>onCommit</em>.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">eventHandler</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Trade</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TRADE_INSERT&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    onCommit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> event </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> trade </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">enteredBy </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">userName</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">        stateMachine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">insert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">ack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create two data classes that will be used in the cancel and allocated Event Handlers. These classes should be in <strong>alpha-messages/src/main/kotlin/global/genesis/alpha/message/event</strong></p><ul><li>TradeAllocated</li><li>TradeCancelled</li></ul><p>Both classes have a single field: <strong>tradeId</strong>.</p><p>TradeAllocated:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">genesis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">alpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">event</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">data</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">TradeAllocated</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> tradeId</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>TradeCancelled:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> global</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">genesis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">alpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">event</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">data</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">TradeCancelled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> tradeId</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a new event handler called TRADE_CANCELLED to handle cancellations. Then integrate the state machine in it.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">eventHandler</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">TradeCancelled</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TRADE_CANCELLED&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> transactional </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    onCommit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> event </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> message </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        stateMachine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">modify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tradeId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> trade </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tradeStatus </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CANCELLED</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">ack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a new event handler called TRADE_ALLOCATED to handle completion. Integrate the state machine in it.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">eventHandler</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">TradeAllocated</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TRADE_ALLOCATED&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> transactional </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    onCommit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> event </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> message </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        stateMachine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">modify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tradeId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> trade </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tradeStatus </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ALLOCATED</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">ack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Modify or add the TRADE_MODIFY Event Handler to use the state machine.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">eventHandler</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Trade</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TRADE_MODIFY&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> transactional </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    onCommit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> event </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> trade </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">        stateMachine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">modify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">ack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Remove the TRADE_DELETE Event Handler if you included it before.</p><p>You want to manage the state of the trade, so remove the delete Event Handler. If a trade is incorrect and needs to be deleted, similar functionality can be achieved by cancelling the trade.</p><p>To test it, you can try to modify a TRADE and see the states changing accordingly. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-41-state-machines">Exercise 4.1: state machines<a class="hash-link" href="#exercise-41-state-machines" title="Direct link to heading">​</a></h3><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>ESTIMATED TIME</div><div class="admonitionContent_S0QG"><p>40 mins</p></div></div><p>Modify the class TradeStateMachine to keep the <code>trade.price</code>. Removing the current rule when TradeStatus.NEW, and set the field trade.enteredBy to empty when TradeStatus.CANCELLED.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>UI CHANGES</div><div class="admonitionContent_S0QG"><p>Open the <strong>home.ts</strong> file and add the TRADE_STATUS field in the const <em>COLUMNS</em>.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//grid columns that will be showed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> COLUMNS </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">defaultColumnConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    field</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> &#x27;TRADE_ID&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    headerName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> &#x27;Id&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">defaultColumnConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    field</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> &#x27;QUANTITY&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    headerName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> &#x27;Quantity&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">defaultColumnConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    field</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> &#x27;PRICE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    headerName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> &#x27;Price&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">defaultColumnConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    field</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> &#x27;SYMBOL&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    headerName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> &#x27;Symbol&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">defaultColumnConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    field</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> &#x27;DIRECTION&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    headerName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> &#x27;Direction&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">defaultColumnConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    field</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> &#x27;TRADE_STATUS&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    headerName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> &#x27;Status&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token label symbol">@customElement</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  styles</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">export </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> Home extends FASTElement </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">super</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And add the <em>deleteEvent</em> as to the <strong>home.template.ts</strong> file.</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">export const HomeTemplate = html</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">Home</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">split-layout</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">top-layout</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;entity-management</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          resourceName=&quot;ALL_TRADES&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          title = &quot;Trades&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          entityLabel=&quot;Trades&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          createEvent = &quot;EVENT_TRADE_INSERT&quot;</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">          deleteEvent = &quot;EVENT_TRADE_CANCELLED&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          :columns=${x =&gt; x.columns}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &gt;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">entity-management</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">`;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Remember to run <a href="/getting-started/developer-training/training-content-day1/#5-build-process">build</a> and <a href="/getting-started/developer-training/training-content-day1/#deploying-the-alpha-product">deploy</a> tasks after the changes, and test it directly in the UI.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="adding-logic-to-the-event-handler">Adding logic to the Event Handler<a class="hash-link" href="#adding-logic-to-the-event-handler" title="Direct link to heading">​</a></h2><p>We are going to change the code in the Event Handler so that:</p><ul><li>it checks if the counterparty exists in the database (by checking COUNTERPARTY_ID field)</li><li>it checks if the instrument exists in the database (by checking INSTRUMENT_ID field)</li><li>it is able to modify records with the same verification on counterparty and instrument</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-the-validation-code">Add the validation code<a class="hash-link" href="#add-the-validation-code" title="Direct link to heading">​</a></h3><p>Go to the <strong>alpha-eventhandler.kts</strong> file for the Event Handler. </p><p>Add the verification by inserting an <strong>verify</strong> inside the <strong>onValidate</strong> block, before the <strong>onCommit</strong> block in TRADE_INSERT. We can see this below, with separate lines checking the Counterparty ID and the Instrument ID exist in the database. The new block ends by sending an <strong>ack()</strong>.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">eventHandler</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Trade</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TRADE_INSERT&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    onValidate </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> event </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> message </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">        verify </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">            entityDb hasEntry Counterparty</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ById</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">counterpartyId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">toString</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">            entityDb hasEntry Instrument</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">byId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">instrumentId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">toString</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">ack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    onCommit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> event </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> trade </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">enteredBy </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">userName</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        stateMachine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">insert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">ack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>verify function</div><div class="admonitionContent_S0QG"><p>The <code>verify</code> block you see above is part of the validation helper provided by the Platform to make it easier to verify conditions against the database. Outside of the <code>verify</code> block, you can write any Kotlin code to validate whatever you want to.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-42-adding-onvalidate-to-event-handlers">Exercise 4.2: adding onValidate to event handlers<a class="hash-link" href="#exercise-42-adding-onvalidate-to-event-handlers" title="Direct link to heading">​</a></h3><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>ESTIMATED TIME</div><div class="admonitionContent_S0QG"><p>20 mins</p></div></div><p>Add the same verification <code>onValidate</code> as in TRADE_INSERT to the TRADE_MODIFY event handler.</p><p>Implement and test the back end with Console or Postman. To do that, see the <a href="/getting-started/developer-training/training-content-day2/#api-testing-with-auto-generated-rest-endpoints">Day 2 example</a>. Basically, you should create a POST request using the URL <em>http://localhost/gwf/EVENT_TRADE_MODIFY</em>, as well as setting the header accordingly (header with SOURCE_REF and SESSION_AUTH_TOKEN). </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="auditing">Auditing​<a class="hash-link" href="#auditing" title="Direct link to heading">​</a></h2><p>We want to be able to track the changes made to the various trades on the TRADE table, such that we could see the times and modifications made in the history of the trade. So, we are going to add basic auditing to the TRADE table in order to keep a record of the changing states of the trades.</p><p>This can be useful for historical purposes, if you need to at a later date be able to produce an accurate course of events.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-basic-auditing">Adding basic auditing<a class="hash-link" href="#adding-basic-auditing" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="adding-audit-to-table-dictionary">Adding audit to table dictionary<a class="hash-link" href="#adding-audit-to-table-dictionary" title="Direct link to heading">​</a></h4><p>The first step to add basic auditing is to change the relevant table dictionary. In this instance, we will be making changes to the <strong>alpha-tables-dictionary.kts</strong>, in order to add the parameter <code>audit = details()</code> to the table definition. It should resemble the following:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">table</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TRADE&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> audit </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">details</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sequence </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TR&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">sequence</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">TRADE_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TR&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    COUNTERPARTY_ID </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    INSTRUMENT_ID not </span><span class="token keyword" style="font-style:italic">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    QUANTITY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    PRICE not </span><span class="token keyword" style="font-style:italic">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SYMBOL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    DIRECTION</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TRADE_DATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ENTERED_BY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TRADE_STATUS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    primaryKey </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        TRADE_ID</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The id parameter indicates the id of the newly created audit table, and will need to be different from any other table id.</p><p>As we are using the GPAL event handlers, this is sufficient to enable auditing on this table. A new table is created by the name of the original table, with the <strong>_AUDIT</strong> suffix added to the end. In this instance that would be the <strong>TRADE_AUDIT</strong> table.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="updating-the-state-machine-to-use-auditing">Updating the state machine to use auditing<a class="hash-link" href="#updating-the-state-machine-to-use-auditing" title="Direct link to heading">​</a></h4><p>Next you need to extend the insert, and modify methods in the <strong>TradeStateMachine.kt</strong> file. Specifically, each method must be have a second option so that the method signature uses the <strong>AsyncMultiEntityReadWriteGenericSupport</strong> parameter and the <code>internalState.withTransaction(transaction) { }</code> code block.  For example:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">suspend</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fun</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">insert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">        transaction</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> AsyncMultiEntityReadWriteGenericSupport</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        trade</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Transition</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeEffect</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">        internalState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">withTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">transaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">suspend</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fun</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">modify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">        transaction</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> AsyncMultiEntityReadWriteGenericSupport</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tradeId</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> modify</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">suspend</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> Unit</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Transition</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeEffect</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        internalState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">withTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">transaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">update</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ById</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tradeId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> _ </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">modify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">suspend</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fun</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">modify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">        transaction</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> AsyncMultiEntityReadWriteGenericSupport</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        trade</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Trade</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Transition</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TradeEffect</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">        internalState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">withTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">transaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">update</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="update-the-event-handlers-to-use-auditing">Update the Event Handlers to use auditing<a class="hash-link" href="#update-the-event-handlers-to-use-auditing" title="Direct link to heading">​</a></h4><p>Now you must update the <strong>alpha-eventhandler.kts</strong> in order to pass the <code>entityDb</code> object into the updated methods of the state machine, as the <strong>syncMultiEntityReadWriteGenericSupport</strong> parameter. This should resemble the example below:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    eventHandler</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Trade</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TRADE_INSERT&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        onValidate </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> event </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> message </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            verify </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                entityDb hasEntry Counterparty</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ById</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">counterpartyId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                entityDb hasEntry Instrument</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ById</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">instrumentId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">ack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        onCommit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> event </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> trade </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">            stateMachine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">insert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">entityDb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">ack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    eventHandler</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Trade</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TRADE_MODIFY&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        onCommit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> event </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> trade </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">            stateMachine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">modify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">entityDb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">ack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    eventHandler</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">TradeCancelled</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TRADE_CANCELLED&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        onCommit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> event </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> message </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">            stateMachine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">modify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">entityDb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tradeId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> trade </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tradeStatus </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CANCELLED</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">ack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    eventHandler</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">TradeAllocated</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string-literal singleline string" style="color:rgb(195, 232, 141)">&quot;TRADE_ALLOCATED&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        onCommit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> event </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">val</span><span class="token plain"> message </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">            stateMachine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">modify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">entityDb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tradeId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> trade </span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                trade</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tradeStatus </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> TradeStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ALLOCATED</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">ack</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Run the <!-- -->[dao]<!-- -->, <a href="/getting-started/developer-training/training-content-day1/#5-build-process">build</a> and <a href="/getting-started/developer-training/training-content-day1/#deploying-the-alpha-product">deploy</a> tasks.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-43-testing-an-audited-table">Exercise 4.3: testing an audited table<a class="hash-link" href="#exercise-43-testing-an-audited-table" title="Direct link to heading">​</a></h3><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>ESTIMATED TIME</div><div class="admonitionContent_S0QG"><p>20 mins</p></div></div><p>Try to insert or modify a TRADE and see the auditing happening accordingly. You can use DbMon or Genesis Console to check the data in table TRADE_AUDIT.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/getting-started/">getting started</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/quick-start/">quick start</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/developer-training/">developer training</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/day-four/">day four</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/getting-started/developer-training/training-content-day3/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Day three</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/getting-started/developer-training/training-content-day5/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Day five</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#state-management" class="table-of-contents__link toc-highlight">State management​</a><ul><li><a href="#1-data-model" class="table-of-contents__link toc-highlight">1. Data model</a></li><li><a href="#2-create-a-new-class-for-the-state-machine" class="table-of-contents__link toc-highlight">2. Create a new class for the state machine</a></li><li><a href="#3-add-the-module-as-a-dependency-in-the-buildgradlekts-inside-alpha-script-config-module" class="table-of-contents__link toc-highlight">3. Add the module as a dependency in the <em>build.gradle.kts</em> inside <strong>alpha-script-config</strong> module.</a></li><li><a href="#4-edit-the-event-handler-to-add-an-integrated-state-machine" class="table-of-contents__link toc-highlight">4. Edit the event handler to add an integrated state machine</a></li><li><a href="#exercise-41-state-machines" class="table-of-contents__link toc-highlight">Exercise 4.1: state machines</a></li></ul></li><li><a href="#adding-logic-to-the-event-handler" class="table-of-contents__link toc-highlight">Adding logic to the Event Handler</a><ul><li><a href="#add-the-validation-code" class="table-of-contents__link toc-highlight">Add the validation code</a></li><li><a href="#exercise-42-adding-onvalidate-to-event-handlers" class="table-of-contents__link toc-highlight">Exercise 4.2: adding onValidate to event handlers</a></li></ul></li><li><a href="#auditing" class="table-of-contents__link toc-highlight">Auditing​</a><ul><li><a href="#adding-basic-auditing" class="table-of-contents__link toc-highlight">Adding basic auditing</a></li><li><a href="#exercise-43-testing-an-audited-table" class="table-of-contents__link toc-highlight">Exercise 4.3: testing an audited table</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© genesis global 2022. All rights reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1e787288.js"></script>
<script src="/assets/js/main.d2eb593c.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5GTR43J" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>