"use strict";(self.webpackChunk_genesislcap_docs=self.webpackChunk_genesislcap_docs||[]).push([[80157],{63106:function(e,t,n){n.r(t),n.d(t,{assets:function(){return m},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return r},metadata:function(){return p},toc:function(){return d}});var a=n(87462),i=n(63366),o=(n(67294),n(3905)),s=(n(61839),["components"]),r={title:"Notify - Symphony",sidebar_label:"Symphony",id:"symphony",keywords:["server","integration","notify","symphony"],tags:["server","integration","notify","symphony"]},l=void 0,p={unversionedId:"server/integration/notify/symphony",id:"version-2022.3/server/integration/notify/symphony",title:"Notify - Symphony",description:"Symphony is a secure instant messaging service focused on financial companies.",source:"@site/versioned_docs/version-2022.3/03_server/10_integration/06_notify/03_symphony.md",sourceDirName:"03_server/10_integration/06_notify",slug:"/server/integration/notify/symphony",permalink:"/server/integration/notify/symphony",draft:!1,tags:[{label:"server",permalink:"/tags/server"},{label:"integration",permalink:"/tags/integration"},{label:"notify",permalink:"/tags/notify"},{label:"symphony",permalink:"/tags/symphony"}],version:"2022.3",sidebarPosition:3,frontMatter:{title:"Notify - Symphony",sidebar_label:"Symphony",id:"symphony",keywords:["server","integration","notify","symphony"],tags:["server","integration","notify","symphony"]},sidebar:"serverModulesSidebar",previous:{title:"Email",permalink:"/server/integration/notify/email"},next:{title:"Microsoft teams",permalink:"/server/integration/notify/microsoft-teams"}},m={},d=[{value:"Symphony configuration",id:"symphony-configuration",level:2},{value:"Using system definition in the notify.kts script",id:"using-system-definition-in-the-notifykts-script",level:2},{value:"Database configuration",id:"database-configuration",level:2},{value:"GATEWAY",id:"gateway",level:3},{value:"NOTIFY",id:"notify",level:3},{value:"Genesis Notify operations for Symphony",id:"genesis-notify-operations-for-symphony",level:2},{value:"Configuring OBO for outgoing messages",id:"configuring-obo-for-outgoing-messages",level:2}],y={toc:d};function h(e){var t=e.components,n=(0,i.Z)(e,s);return(0,o.kt)("wrapper",(0,a.Z)({},y,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"http://symphony.com"},"Symphony")," is a secure instant messaging service focused on financial companies.\nTo make Symphony services available to Genesis, including the sending and receiving of messages, you need to provision ",(0,o.kt)("a",{parentName:"p",href:"https://symphony.com/participate"},"symphony service")," and configure a ",(0,o.kt)("a",{parentName:"p",href:"https://docs.developers.symphony.com/developer-tools/developer-tools/bdk-2.0"},"symphony bot"),"."),(0,o.kt)("h2",{id:"symphony-configuration"},"Symphony configuration"),(0,o.kt)("p",null,"Genesis requires the use of Symphony POD, Symphony Bot and the generation of private/public key pairs. This is covered extensively in the Symphony ",(0,o.kt)("a",{parentName:"p",href:"https://docs.developers.symphony.com/building-bots-on-symphony/overview-of-rest-api/pod-api"},"documentation"),".  "),(0,o.kt)("p",null,"Symphony must be configured in your ",(0,o.kt)("strong",{parentName:"p"},"notify.kts")," file. Here is an example configuration with connection details. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'notify {\n\n    // note: the connection \'id\' will default to \'Symphony\' if it\'s not specified, however if you have multiple connections\n    //       of the same type (in this case symphony) then it will need to be specified. \n    symphony(id = "symphony1") {\n\n        sessionAuthHost = "76680.p.symphony.com"\n        botUsername = "botusergenesis@genesis.global"\n        botPrivateKeyPath = "/home/priss/run/site-specific/cfg/symphony/rsa/"\n        botPrivateKeyName = "bot1.test.pem"\n        appId = "GENESIS_EXTENSION_APP"  // optional, required for Symphony OBO feature\n    }\n    \n    // optionally include additional connections, including additional Symphony, Email or Microsoft Teams connections \n}\n\n')),(0,o.kt)("p",null,"Now consider another example. For this, the private key is sourced from the DB. "),(0,o.kt)("p",null,"To store the private key in a DB, you need to use the ",(0,o.kt)("inlineCode",{parentName:"p"},"SYSTEM")," table with ",(0,o.kt)("inlineCode",{parentName:"p"},"SYSTEM_VALUE")," set to the contents of the private key and the associated ",(0,o.kt)("inlineCode",{parentName:"p"},"SYSTEM_KEY")," set to ",(0,o.kt)("inlineCode",{parentName:"p"},"SymphonyRsaKey"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'notify {\n\n    symphony(id = "symphony1") {\n\n        sessionAuthHost = "76680.p.symphony.com"\n        botUsername = "botusergenesis@genesis.global"\n        botPrivateKeyFromDb = true\n    }\n    \n}\n\n')),(0,o.kt)("h2",{id:"using-system-definition-in-the-notifykts-script"},"Using system definition in the notify.kts script"),(0,o.kt)("p",null,"You must configure Notify in your application's ",(0,o.kt)("strong",{parentName:"p"},"genesis-system-definition.kts")," file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'systemDefinition {\n    global {\n        \n            item(name = "SESSION_AUTH_HOST", value = "76680.p.symphony.com" )\n            item(name = "BOT_USER_NAME", value = "botusergenesis@genesis.global" )         \n        }\n}\n')),(0,o.kt)("p",null,"Once that is configured, you can refer to the item name directly in your ",(0,o.kt)("strong",{parentName:"p"},"notify.kts")," script, without import or qualifier."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-Kotlin"},'notify {\n\n    symphony(id = "symphony1") {\n\n        sessionAuthHost = SESSION_AUTH_HOST\n        botUsername = BOT_USER_NAME\n        botPrivateKeyFromDb = true\n    }\n    \n}\n')),(0,o.kt)("p",null,"Where you have configured a Symphony Gateway for handling incoming messages, any attachments to incoming messages will be dropped on the server to the following configured directory parameter: ",(0,o.kt)("inlineCode",{parentName:"p"},"DOCUMENT_STORE_BASEDIR"),". "),(0,o.kt)("p",null,"For example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'item(name = "DOCUMENT_STORE_BASEDIR", value = "/home/trading/run/site-specific/incoming-docs")\n')),(0,o.kt)("p",null,"If the incoming message is configured to publish to a topic, the file name of any attachment will be sent to the ",(0,o.kt)("inlineCode",{parentName:"p"},"DOCUMENT_ID")," field for the topic (showing its file location on the server). In the event of clashing file names, the incoming attachment's file name will have the suffix _1, _2 added, as appropriate."),(0,o.kt)("h2",{id:"database-configuration"},"Database configuration"),(0,o.kt)("h3",{id:"gateway"},"GATEWAY"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Field Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Usage"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"GATEWAY_ID"),(0,o.kt)("td",{parentName:"tr",align:null},"A unique name for the gateway, which can be referenced in the ",(0,o.kt)("inlineCode",{parentName:"td"},"NOTIFY_ROUTE")," table")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"GATEWAY_TYPE"),(0,o.kt)("td",{parentName:"tr",align:null},"For Symphony connection this might be SymphonyRoom, SymphonyByUserEmail, SymphonyRoomReqRep")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"GATEWAY_VALUE"),(0,o.kt)("td",{parentName:"tr",align:null},"This is the room name specified as Symphony Conversation Id Or ",(0,o.kt)("a",{parentName:"td",href:"https://docs.developers.symphony.com/building-bots-on-symphony/datafeed/overview-of-streams"},"Stream Id"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"INCOMING_TOPIC"),(0,o.kt)("td",{parentName:"tr",align:null},"When the ",(0,o.kt)("inlineCode",{parentName:"td"},"GATEWAY_TYPE")," is specified as SymphonyRoom, then incoming messages are directed to this ",(0,o.kt)("inlineCode",{parentName:"td"},"TOPIC"),". ",(0,o.kt)("br",null),"  When the ",(0,o.kt)("inlineCode",{parentName:"td"},"GATEWAY_TYPE")," is specified as SymphonyRoomReqRep then it's treated as colon-separated string specifying the ",(0,o.kt)("inlineCode",{parentName:"td"},"PROCESS_NAME:EVENT_HANDLER_NAME"),", such that incoming messages will be directed to the named Event Handler running in the named process")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"CONNECTION_ID"),(0,o.kt)("td",{parentName:"tr",align:null},"This should reference the connection ",(0,o.kt)("inlineCode",{parentName:"td"},"id")," specified in the ",(0,o.kt)("inlineCode",{parentName:"td"},"notify.kts")," file. Note if no id is specified in the connection, then you should use the default id of ",(0,o.kt)("inlineCode",{parentName:"td"},"Symphony"))))),(0,o.kt)("h3",{id:"notify"},"NOTIFY"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Field Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Usage"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"SENDER"),(0,o.kt)("td",{parentName:"tr",align:null},"Genesis User sending message, if Symphony OBO is activated then this message will be sent 'On Behalf Of' of this user")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"TOPIC"),(0,o.kt)("td",{parentName:"tr",align:null},"The Topic to broadcast this message")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"HEADER"),(0,o.kt)("td",{parentName:"tr",align:null},"Header that appended to beginning of every message")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"NOTIFY_SEVERITY"),(0,o.kt)("td",{parentName:"tr",align:null},'An ENUM of either, "Information", "Warning", "Serious", "Critical", which defaults to "Information". This is simply appended to a Symphony Message Header')),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"BODY"),(0,o.kt)("td",{parentName:"tr",align:null},"Message as Symphony ",(0,o.kt)("a",{parentName:"td",href:"https://docs.developers.symphony.com/building-bots-on-symphony/messages/overview-of-messageml/message-format-messageml"},"MessageML")," Format")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"NOTIFY_COMPRESSION_TYPE"),(0,o.kt)("td",{parentName:"tr",align:null},"Do not set. This is used internally by Genesis; it indicates if the body of the message is compressed and by which compression type")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"DOCUMENT_ID"),(0,o.kt)("td",{parentName:"tr",align:null},"If set, this should refer to a server-side path and file name. This file will be attached to the outgoing message that is destined for a Symphony gateway")))),(0,o.kt)("h2",{id:"genesis-notify-operations-for-symphony"},"Genesis Notify operations for Symphony"),(0,o.kt)("p",null,"The Notify service currently provides additional Symphony operations; these are exposed as Event Handlers."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GATEWAY_CREATE_CHANNEL")," creates a channel (to allow external users to be added to a channel; a channel should be created with ",(0,o.kt)("inlineCode",{parentName:"li"},"external")," set to ",(0,o.kt)("inlineCode",{parentName:"li"},"true")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"public")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"false"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GATEWAY_ADD_MEMBER_TO_CHANNEL")," adds a user to a channel (if the user is not a member of the host POD, then a connection request will be sent to that user)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GATEWAY_REMOVE_MEMBER_FROM_CHANNEL")," removes a user from a channel"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GATEWAY_ACTION_ON_CHANNEL")," allows a channel to be either reactivated or deactivated")),(0,o.kt)("p",null,"Where there is more than one Symphony connection defined, these operations act upon the first listed."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"package global.genesis.message.core.event.notify\ndata class CreateChannel(\n    val topic: String,\n    val channelName: String,\n    val external: Boolean = false,\n    val multilateral: Boolean = false,\n    val discoverable: Boolean = true,\n    val public: Boolean = true\n)\ndata class AddUserToChannel(val channelName: String, val userId: String)\ndata class RemoveUserFromChannel(val channelName: String, val userId: String)\ndata class ActionOnChannel(val roomId: String, val activate: Boolean)\n")),(0,o.kt)("p",null,"The Notify service also offers the following Request Server resource ",(0,o.kt)("inlineCode",{parentName:"p"},"LIST_MEMBERS_OF_CHANNEL"),", which, unsurprisingly, lists members of a channel."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Inputs (Request)"),(0,o.kt)("p",{parentName:"li"},"  ",(0,o.kt)("inlineCode",{parentName:"p"},"ChannelName")," - Symphony Stream Id")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Outputs (Response)"),(0,o.kt)("p",{parentName:"li"},"  ",(0,o.kt)("inlineCode",{parentName:"p"},"USER_EMAIL")),(0,o.kt)("p",{parentName:"li"},"  ",(0,o.kt)("inlineCode",{parentName:"p"},"USER_ID"),"  - Symphony User Id"))),(0,o.kt)("h2",{id:"configuring-obo-for-outgoing-messages"},"Configuring OBO for outgoing messages"),(0,o.kt)("p",null,"To use the Symphony On-behalf-of (OBO) feature, which enables messages to be sent through a configured Symphony robot as a particular user, you need to configure your application to point to the required Symphony extension app. "),(0,o.kt)("p",null,"You can find out how set this up in the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.developers.symphony.com/building-extension-applications-on-symphony/app-authentication/obo-authentication"},"Symphony Documentation")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'item(name = "SYMPHONY_APP_ID", value = "GENESIS_EXTENSION_APP")\n')))}h.isMDXComponent=!0}}]);