"use strict";(self.webpackChunk_genesislcap_docs=self.webpackChunk_genesislcap_docs||[]).push([[76314],{24269:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return g},frontMatter:function(){return r},metadata:function(){return d},toc:function(){return c}});var a=n(87462),i=n(63366),s=(n(67294),n(3905)),o=(n(61839),["components"]),r={title:"Loading feed data - SFTP and encryption",sidebar_label:"SFTP and encryption",id:"sftp-and-encryption",keywords:["getting started","quick start","use cases","loading feed data","sftp","encryption"],tags:["getting started","quick start","use cases","loading feed data","sftp","encryption"]},l=void 0,d={unversionedId:"getting-started/use-cases/loading-feed-data/sftp-and-encryption",id:"getting-started/use-cases/loading-feed-data/sftp-and-encryption",title:"Loading feed data - SFTP and encryption",description:"If you are loading static data from an external site, this page gives more detail on the SFTP method for obtaining the data. It also looks at how you could deal with encryption and decryption in higher environments.",source:"@site/docs/01_getting-started/05_use-cases/03-loading-feed-data/02_sftp-and-encryption.md",sourceDirName:"01_getting-started/05_use-cases/03-loading-feed-data",slug:"/getting-started/use-cases/loading-feed-data/sftp-and-encryption",permalink:"/next/getting-started/use-cases/loading-feed-data/sftp-and-encryption",draft:!1,tags:[{label:"getting started",permalink:"/next/tags/getting-started"},{label:"quick start",permalink:"/next/tags/quick-start"},{label:"use cases",permalink:"/next/tags/use-cases"},{label:"loading feed data",permalink:"/next/tags/loading-feed-data"},{label:"sftp",permalink:"/next/tags/sftp"},{label:"encryption",permalink:"/next/tags/encryption"}],version:"current",sidebarPosition:2,frontMatter:{title:"Loading feed data - SFTP and encryption",sidebar_label:"SFTP and encryption",id:"sftp-and-encryption",keywords:["getting started","quick start","use cases","loading feed data","sftp","encryption"],tags:["getting started","quick start","use cases","loading feed data","sftp","encryption"]},sidebar:"learningSidebar",previous:{title:"Loading feed data",permalink:"/next/getting-started/use-cases/loading-feed-data/overview"},next:{title:"Example source data",permalink:"/next/getting-started/use-cases/loading-feed-data/example-source-data"}},p={},c=[{value:"SFTP",id:"sftp",level:2},{value:"Encryption",id:"encryption",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}],m={toc:c};function g(e){var t=e.components,r=(0,i.Z)(e,o);return(0,s.kt)("wrapper",(0,a.Z)({},m,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"If you are loading static data from an external site, this page gives more detail on the SFTP method for obtaining the data. It also looks at how you could deal with encryption and decryption in higher environments."),(0,s.kt)("h2",{id:"sftp"},"SFTP"),(0,s.kt)("p",null,"Below, the simple ",(0,s.kt)("em",{parentName:"p"},"application"),(0,s.kt)("strong",{parentName:"p"},"-camel.kts")," file has had an SFTP route added to it."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-kotlin"},'camel {\n    routeHandler {\n        //Handles sFTP BBG file transfer\n        val bbgEndPointPath = systemDefinition.getItem("BBG_SERVER_SFTP")\n        val bbgUserName = systemDefinition.getItem("BBG_SERVER_USERNAME")\n        val bbgPassword = systemDefinition.getItem("BBG_SERVER_PASSWORD")\n        val bbgFileName = systemDefinition.getItem("BBG_SERVER_FILENAME")\n        // String bbgFileName = "GEN_(PREL|PRICED)_[0-9]{4}\\\\.out\\\\.[0-9]{8}"\n        val pathStr = "${GenesisPaths.genesisHome()}/runtime/inbound/IDEMPOTENT_CONSUMER.DATA"\n        val bbgConsumerRepo = "${pathStr}IDEMPOTENT_CONSUMER.DATA"\n        from("sftp:${bbgEndPointPath}?username=${bbgUserName}&password=${bbgPassword}&include=$${bbgFileName}" +\n            "&delay=1000&sortBy=file:modified&delete=false&bridgeErrorHandler=true" +\n            "&knownHostsFile=/home/priss/.ssh/known_hosts&throwExceptionOnConnectFailed=true&stepwise=false")\n            .idempotentConsumer(header("CamelFileName"),\n                FileIdempotentRepository.fileIdempotentRepository(File(bbgConsumerRepo), 300000, 15000000))\n            .process { exchange ->\n                LOG.debug("SFTP copy CamelFileName = ${exchange.`in`.getHeader("CamelFileNameOnly").toString()}")\n            }\n            .log("BBG file transfer: \\${headers.CamelFileName}")\n            .to("file:${pathStr}/bbg")\n    }\n}\n')),(0,s.kt)("p",null,"By using the ",(0,s.kt)("inlineCode",{parentName:"p"},"systemDefinition")," to get items, we can use site-specific variables for each instance (for example,  username, password, and hosts can change between ",(0,s.kt)("strong",{parentName:"p"},"DEV"),", ",(0,s.kt)("strong",{parentName:"p"},"QA"),", ",(0,s.kt)("strong",{parentName:"p"},"UAT"),", and ",(0,s.kt)("strong",{parentName:"p"},"PROD")," instances)."),(0,s.kt)("p",null,"These variables values are defined in the ",(0,s.kt)("em",{parentName:"p"},"application"),(0,s.kt)("strong",{parentName:"p"},"-system-definition.kts")," for each of the application instances. In the example below, we specify the username and password for the ",(0,s.kt)("strong",{parentName:"p"},"QA")," instance:"),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(47159).Z,width:"624",height:"144"})),(0,s.kt)("p",null,"This way you can dynamically define hosts, usernames, passwords, and even file names to find. These are passed into the route to configure the Apache Camel SFTP connection.  Camel will poll the sFTP server to look for unprocessed files, and download them into the staging directory (",(0,s.kt)("strong",{parentName:"p"},"\u2026/bbg")," in this instance). Only unprocessed files are downloaded, because we have configured ",(0,s.kt)("inlineCode",{parentName:"p"},"idempotentConsumer"),", which has a DB that is used to store the downloaded file names."),(0,s.kt)("h2",{id:"encryption"},"Encryption"),(0,s.kt)("p",null,"In higher environments, you need to encrypt sensitive values in the ",(0,s.kt)("em",{parentName:"p"},"application"),(0,s.kt)("strong",{parentName:"p"},"-system-definition.kts")," file."),(0,s.kt)("p",null,"The steps to follow are:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Generate a GENESIS_KEY key for each of the environments (specially for PROD and UAT)."),(0,s.kt)("li",{parentName:"ol"},"Pass the GENESIS_KEY to each instance as an environment variable."),(0,s.kt)("li",{parentName:"ol"},"Using the GENESIS_KEY, encrypt the ",(0,s.kt)("inlineCode",{parentName:"li"},"username")," and ",(0,s.kt)("inlineCode",{parentName:"li"},"password")," with the ",(0,s.kt)("inlineCode",{parentName:"li"},"encryptUserPassWithKey")," command in the Genesis instance."),(0,s.kt)("li",{parentName:"ol"},"Add the encrypted ",(0,s.kt)("inlineCode",{parentName:"li"},"username")," and ",(0,s.kt)("inlineCode",{parentName:"li"},"password")," to the relevant section (",(0,s.kt)("strong",{parentName:"li"},"DEV"),", ",(0,s.kt)("strong",{parentName:"li"},"UAT"),", etc...) of the ",(0,s.kt)("em",{parentName:"li"},"application"),(0,s.kt)("strong",{parentName:"li"},"-system-definition.kts")," file."),(0,s.kt)("li",{parentName:"ol"},"Finally, because your password is encrypted in the script/configuration you are changing, the ",(0,s.kt)("inlineCode",{parentName:"li"},"systemDefinition")," object will automatically decrypt it. Here is an example:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-kotlin"},'camel {\n    routeHandler.with {\n        val pathStr = "${GenesisPaths.genesisHome()}/runtime/inbound/"\n        val bbgUserName = systemDefinition.getItem("BBG_SERVER_USERNAME")\n        val bbgPassword = systemDefinition.getItem("BBG_SERVER_PASSWORD")\n    }\n}\n')),(0,s.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,s.kt)("p",null,"Check that your environment variables are set up. Look in the ",(0,s.kt)("strong",{parentName:"p"},".bachrc")," file in the home directory of the application. At the bottom of the script, you will see a reference to ",(0,s.kt)("em",{parentName:"p"},"IP address"),(0,s.kt)("strong",{parentName:"p"},"/latest/user-data"),". This is used to generate the environment variables. Check that your environment variable exists in the list. And does it return from the request?"))}g.isMDXComponent=!0},47159:function(e,t,n){t.Z=n.p+"assets/images/variables-qa-f3aaa3fe0cc3d2dd3950331a8fc14c5d.png"}}]);