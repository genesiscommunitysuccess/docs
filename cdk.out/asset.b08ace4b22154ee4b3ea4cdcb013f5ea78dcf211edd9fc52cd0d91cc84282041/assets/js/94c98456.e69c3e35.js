"use strict";(self.webpackChunk_genesislcap_docs=self.webpackChunk_genesislcap_docs||[]).push([[17239],{85162:function(e,t,n){n.d(t,{Z:function(){return o}});var a=n(67294),i=n(86010),r="tabItem_Ymn6";function o(e){var t=e.children,n=e.hidden,o=e.className;return a.createElement("div",{role:"tabpanel",className:(0,i.Z)(r,o),hidden:n},t)}},65488:function(e,t,n){n.d(t,{Z:function(){return m}});var a=n(87462),i=n(67294),r=n(86010),o=n(72389),l=n(67392),s=n(7094),p=n(12466),d="tabList__CuJ",u="tabItem_LNqP";function c(e){var t,n,o=e.lazy,c=e.block,m=e.defaultValue,h=e.values,g=e.groupId,f=e.className,v=i.Children.map(e.children,(function(e){if((0,i.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),k=null!=h?h:v.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),N=(0,l.l)(k,(function(e,t){return e.value===t.value}));if(N.length>0)throw new Error('Docusaurus error: Duplicate values "'+N.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var b=null===m?m:null!=(t=null!=m?m:null==(n=v.find((function(e){return e.props.default})))?void 0:n.props.value)?t:v[0].props.value;if(null!==b&&!k.some((function(e){return e.value===b})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+b+'" but none of its children has the corresponding value. Available values are: '+k.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var T=(0,s.U)(),y=T.tabGroupChoices,E=T.setTabGroupChoices,w=(0,i.useState)(b),C=w[0],S=w[1],_=[],P=(0,p.o5)().blockElementScrollPositionUntilNextRender;if(null!=g){var A=y[g];null!=A&&A!==C&&k.some((function(e){return e.value===A}))&&S(A)}var x=function(e){var t=e.currentTarget,n=_.indexOf(t),a=k[n].value;a!==C&&(P(t),S(a),null!=g&&E(g,String(a)))},D=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a,i=_.indexOf(e.currentTarget)+1;n=null!=(a=_[i])?a:_[0];break;case"ArrowLeft":var r,o=_.indexOf(e.currentTarget)-1;n=null!=(r=_[o])?r:_[_.length-1]}null==(t=n)||t.focus()};return i.createElement("div",{className:(0,r.Z)("tabs-container",d)},i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":c},f)},k.map((function(e){var t=e.value,n=e.label,o=e.attributes;return i.createElement("li",(0,a.Z)({role:"tab",tabIndex:C===t?0:-1,"aria-selected":C===t,key:t,ref:function(e){return _.push(e)},onKeyDown:D,onFocus:x,onClick:x},o,{className:(0,r.Z)("tabs__item",u,null==o?void 0:o.className,{"tabs__item--active":C===t})}),null!=n?n:t)}))),o?(0,i.cloneElement)(v.filter((function(e){return e.props.value===C}))[0],{className:"margin-top--md"}):i.createElement("div",{className:"margin-top--md"},v.map((function(e,t){return(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==C})}))))}function m(e){var t=(0,o.Z)();return i.createElement(c,(0,a.Z)({key:String(t)},e))}},55448:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return d},default:function(){return g},frontMatter:function(){return p},metadata:function(){return u},toc:function(){return m}});var a=n(87462),i=n(63366),r=(n(67294),n(3905)),o=(n(61839),n(65488)),l=n(85162),s=["components"],p={title:"Server Specialist Developer Training - Day five",sidebar_label:"Day five",sidebar_position:6,id:"05_ssdt-day5",keywords:["getting started","developer training","server training","day five"],tags:["getting started","developer training","server training","day five"]},d=void 0,u={unversionedId:"getting-started/server_training/05_ssdt-day5",id:"version-2022.3/getting-started/server_training/05_ssdt-day5",title:"Server Specialist Developer Training - Day five",description:"This day covers:",source:"@site/versioned_docs/version-2022.3/01_getting-started/09_server_training/05_ssdt-day5.md",sourceDirName:"01_getting-started/09_server_training",slug:"/getting-started/server_training/05_ssdt-day5",permalink:"/getting-started/server_training/05_ssdt-day5",draft:!1,tags:[{label:"getting started",permalink:"/tags/getting-started"},{label:"developer training",permalink:"/tags/developer-training"},{label:"server training",permalink:"/tags/server-training"},{label:"day five",permalink:"/tags/day-five"}],version:"2022.3",sidebarPosition:6,frontMatter:{title:"Server Specialist Developer Training - Day five",sidebar_label:"Day five",sidebar_position:6,id:"05_ssdt-day5",keywords:["getting started","developer training","server training","day five"],tags:["getting started","developer training","server training","day five"]},sidebar:"learningSidebar",previous:{title:"Day four",permalink:"/getting-started/server_training/04_ssdt-day4"},next:{title:"Introduction",permalink:"/getting-started/web-training/training-intro"}},c={},m=[{value:"Custom endpoints",id:"custom-endpoints",level:2},{value:"FileEndpointCommon",id:"fileendpointcommon",level:3},{value:"FileProcessor",id:"fileprocessor",level:3},{value:"Construction and initialisation",id:"construction-and-initialisation",level:3},{value:"Endpoint name",id:"endpoint-name",level:3},{value:"Allowed methods",id:"allowed-methods",level:3},{value:"Processing requests",id:"processing-requests",level:3},{value:"Authentication",id:"authentication",level:3},{value:"Exercise 5.1 Trade.getBulk to CSV Download Endpoint",id:"exercise-51-tradegetbulk-to-csv-download-endpoint",level:4},{value:"Camel module",id:"camel-module",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Exercise 5.2 Reading and writing using an SFTP server",id:"exercise-52-reading-and-writing-using-an-sftp-server",level:4},{value:"Data Pipeline",id:"data-pipeline",level:2},{value:"Configuration",id:"configuration-1",level:3},{value:"Exercise 5.3 Reading and writing using an SFTP server",id:"exercise-53-reading-and-writing-using-an-sftp-server",level:4}],h={toc:m};function g(e){var t=e.components,n=(0,i.Z)(e,s);return(0,r.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This day covers:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#custom-endpoints"},"Custom endpoints")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#camel-module"},"Camel module\u200b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#data-pipeline"},"Data pipeline"))),(0,r.kt)("h2",{id:"custom-endpoints"},"Custom endpoints"),(0,r.kt)("p",null,"The Genesis low-code platform provides a series of REST endpoints exposing all configured resources (like Event Handlers, Request Server, Data Servers, Authentication) as HTTP endpoints via the ",(0,r.kt)("a",{parentName:"p",href:"/server/configuring-runtime/genesis-router/"},"GENESIS_ROUTER")," service. "),(0,r.kt)("p",null,"You can extend the platform by creating custom endpoints, which make it easy to integrate with existing systems. Likely uses for these custom endpoints include: file upload and download, and integration into external authentication systems."),(0,r.kt)("p",null,"To create a custom endpoint using the Genesis Router, simply implement the ",(0,r.kt)("inlineCode",{parentName:"p"},"WebEndpoint")," interface provided by Genesis Router. Call upon the ",(0,r.kt)("inlineCode",{parentName:"p"},"registerEndpoint")," method of an injected ",(0,r.kt)("inlineCode",{parentName:"p"},"WebEndpointRegistry")," object."),(0,r.kt)("p",null,"In the following examples, a ",(0,r.kt)("inlineCode",{parentName:"p"},"FileEndpointCommon")," class has also been created to hold utility methods that may be needed across multiple endpoints:"),(0,r.kt)("h3",{id:"fileendpointcommon"},"FileEndpointCommon"),(0,r.kt)(o.Z,{defaultValue:"kotlin",values:[{label:"Kotlin",value:"kotlin"},{label:"Java",value:"java"}],mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"kotlin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'public class FileEndpointCommon {\n    companion object {\n        const val ENDPOINT_NAME = "file-handler"\n   }\n}\n'))),(0,r.kt)(l.Z,{value:"java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class FileEndpointCommon {\n    static final String ENDPOINT_NAME = "file-handler";\n}\n')))),(0,r.kt)("h3",{id:"fileprocessor"},"FileProcessor"),(0,r.kt)(o.Z,{defaultValue:"kotlin",values:[{label:"Kotlin",value:"kotlin"},{label:"Java",value:"java"}],mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"kotlin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'@Module\nclass FileProcessorKotlin @Inject constructor(\n    private val registry: WebEndpointRegistry\n) : WebEndpoint {\n    @PostConstruct\n    fun init() {\n        registry.registerEndpoint(FileEndpointCommon.ENDPOINT_NAME, this)\n    }\n\n    override fun allowedMethods(): Set<RequestType> {\n        return ALLOWED_HTTP_METHODS\n    }\n\n    override fun name(): String {\n        return "upload"\n    }\n\n    override fun process(s: String, fullHttpRequest: FullHttpRequest, channel: Channel): Any {\n        LOG.debug("Hit {}/{} endpoint", FileEndpointCommon.ENDPOINT_NAME, name())\n        //This is where you would make calls to other services and libraries with the newly uploaded file.\n        val responseJson = "{ \\"Result\\": \\"Successful upload\\"}".toByteArray(StandardCharsets.UTF_8)\n        val responseBuffer = Unpooled.wrappedBuffer(responseJson)\n        val response = DefaultFullHttpResponse(\n            HttpVersion.HTTP_1_1,\n            HttpResponseStatus.OK,\n            responseBuffer\n        )\n        response.headers().add(HttpHeaderNames.CONTENT_TYPE, HttpHeaderValues.APPLICATION_JSON)\n        HttpUtil.setContentLength(response, responseJson.size.toLong())\n        return response\n    }\n\n    override fun requiresAuth(): Boolean {\n        return if (System.getProperty("TEST_MODE") != null) {\n            false\n        } else {\n            super.requiresAuth()\n        }\n    }\n\n    companion object {\n        private val LOG = LoggerFactory.getLogger(FileProcessorKotlin::class.java)\n        private val ALLOWED_HTTP_METHODS: Set<RequestType> = ImmutableSet.of(RequestType.POST)\n    }\n}\n'))),(0,r.kt)(l.Z,{value:"java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Module\npublic class FileProcessor implements WebEndpoint {\n\n    private static final Logger LOG = LoggerFactory.getLogger(FileProcessor.class);\n    private static final Set<RequestType> ALLOWED_HTTP_METHODS = ImmutableSet.of(RequestType.POST);\n\n    private final WebEndpointRegistry registry;\n\n    @Inject\n    public FileProcessor(WebEndpointRegistry registry) {\n        this.registry = registry;\n    }\n\n    @PostConstruct\n    public void init() {\n        this.registry.registerEndpoint(FileEndpointCommon.ENDPOINT_NAME, this);\n    }\n\n    @NotNull\n    @Override\n    public Set<RequestType> allowedMethods() {\n        return ALLOWED_HTTP_METHODS;\n    }\n\n    @NotNull\n    @Override\n    public String name() {\n        return "upload";\n    }\n\n    @NotNull\n    @Override\n    public Object process(@NotNull String s, @NotNull FullHttpRequest fullHttpRequest, @NotNull Channel channel) {\n        final byte[] responseJson = "{ \\"Result\\": \\"Successful upload\\"}".getBytes(StandardCharsets.UTF_8);\n        //This is where you would make calls to other services and libraries with the newly uploaded file.\n        final ByteBuf responseBuffer = Unpooled.wrappedBuffer(responseJson);\n        final DefaultFullHttpResponse response = new DefaultFullHttpResponse(\n                HttpVersion.HTTP_1_1,\n                HttpResponseStatus.OK,\n                responseBuffer\n        );\n        response.headers().add(HttpHeaderNames.CONTENT_TYPE, HttpHeaderValues.APPLICATION_JSON);\n        HttpUtil.setContentLength(response, responseJson.length);\n        return response;\n    }\n\n    @Override\n    public boolean requiresAuth() {\n        if(System.getProperty("TEST_MODE") != null){\n            return false;\n        } else {\n            return WebEndpoint.super.requiresAuth();\n        }\n    }\n\n}\n')))),(0,r.kt)("h3",{id:"construction-and-initialisation"},"Construction and initialisation"),(0,r.kt)("p",null,"The constructor should contain an instance of the ",(0,r.kt)("inlineCode",{parentName:"p"},"WebEndpointRegistry")," class in order to call upon it during initialisation. This is necessary for the Genesis Router to route appropriate traffic to this endpoint automatically."),(0,r.kt)("p",null,"In the examples above the initialisation step is annotated with ",(0,r.kt)("inlineCode",{parentName:"p"},"@PostConstruct"),", and calls upon the ",(0,r.kt)("inlineCode",{parentName:"p"},"WebEndpointRegistry.registerEndpoint()")," function with the subdirectory of the endpoint, and the endpoint itself. The registered endpoint would be reachable at a combination of this subdirectory, and the return value of the endpoint's ",(0,r.kt)("inlineCode",{parentName:"p"},"name()")," function. In the example, this would be ",(0,r.kt)("inlineCode",{parentName:"p"},"file-handler/upload"),"."),(0,r.kt)("h3",{id:"endpoint-name"},"Endpoint name"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"name()")," method must be overridden to give the endpoint a name."),(0,r.kt)("h3",{id:"allowed-methods"},"Allowed methods"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"allowedMethods()")," function must be overridden and implemented to declare which of the HTTP request types are permitted for this endpoint. It must return a set of ",(0,r.kt)("inlineCode",{parentName:"p"},"RequestType")," objects corresponding with the HTTP ",(0,r.kt)("inlineCode",{parentName:"p"},"GET"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"POST"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"PUT"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"PATCH"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"DELETE")," functions."),(0,r.kt)("h3",{id:"processing-requests"},"Processing requests"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"process()")," function must be overridden and implemented in order to add business logic to the endpoint."),(0,r.kt)("h3",{id:"authentication"},"Authentication"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"requiresAuth()")," function can be overridden to determine if the endpoint requires a ",(0,r.kt)("inlineCode",{parentName:"p"},"SESSION_AUTH_TOKEN")," with the request, such as those made from authenticated sessions. Without a definition, this returns a default value of ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),". In the example above, this Authorisation is not required when the system is running in ",(0,r.kt)("inlineCode",{parentName:"p"},"TEST_MODE"),", which is useful for testing these endpoints with integration tests."),(0,r.kt)("h4",{id:"exercise-51-tradegetbulk-to-csv-download-endpoint"},"Exercise 5.1 Trade.getBulk to CSV Download Endpoint"),(0,r.kt)("admonition",{title:"ESTIMATED TIME",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"45 mins")),(0,r.kt)("p",null,"We are going to create a new endpoint where the result of Trade.getBulk should write a CSV file and then download it. "),(0,r.kt)("p",null,"Use the knowledge you have acquired so far to create a class implementing the interface ",(0,r.kt)("inlineCode",{parentName:"p"},"WebEndpoint"),"."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"There is a similar sample ",(0,r.kt)("a",{parentName:"p",href:"/server/integration/custom-endpoints/advanced/#attachmentdownloadendpoint"},"here"),", which defines Attachments Download Endpoint.")),(0,r.kt)("h2",{id:"camel-module"},"Camel module"),(0,r.kt)("p",null,"The Genesis platform supports the use of ",(0,r.kt)("a",{parentName:"p",href:"https://camel.apache.org/"},"Apache Camel")," in order to integrate with external systems, using its plethora of ",(0,r.kt)("a",{parentName:"p",href:"https://camel.apache.org/components/3.16.x/index.html"},"components"),". Genesis makes this easy to configure and set up, allowing new processors to be defined and used within GPAL."),(0,r.kt)("p",null,"Likely uses for Apache Camel include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"receiving data from the local filesystem"),(0,r.kt)("li",{parentName:"ul"},"receiving data from an external location"),(0,r.kt)("li",{parentName:"ul"},"sending data to an external location")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Note that Camel's power and flexibility comes at the cost of some complexity and configuration overhead. If you simply want to ingest and transform data from the most common sources (e.g. CSV files and certain relational databases), you should first investigate the new ",(0,r.kt)("a",{parentName:"p",href:"/server/integration/data-pipeline/introduction/"},"Genesis Data Pipeline"),", which offers a higher-level ingestion workflow than the Apache Camel DSL.")),(0,r.kt)("p",null,"Apache Camel integrations are defined within your application's ",(0,r.kt)("strong",{parentName:"p"},"-camel.kts")," file. This is located in the ",(0,r.kt)("strong",{parentName:"p"},"src/main/resources/scripts")," directory within your application's ",(0,r.kt)("strong",{parentName:"p"},"-script-config")," submodule."),(0,r.kt)("p",null,"The Genesis low-code platform only includes the ",(0,r.kt)("inlineCode",{parentName:"p"},"camel-core")," dependency. You will want to declare additional dependencies to make best use of the different available Camel components."),(0,r.kt)("h3",{id:"configuration"},"Configuration"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add the configuration for the Camel module to the {applicationName}-processes.xml file:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'  <process name="ALPHA_CAMEL">\n    <groupId>ALPHA</groupId>\n    <start>true</start>\n    <options>-Xmx256m -DRedirectStreamsToLog=true -DXSD_VALIDATE=false</options>\n    <module>genesis-pal-camel</module>\n    <package>global.genesis.eventhandler.pal</package>\n    <script>alpha-eventhandler.kts<\/script>\n    <description>Handles events</description>\n    <classpath>alpha-messages*,alpha-camel*,alpha-camel-libs*.jar</classpath>\n    <language>pal</language>\n  </process>\n')),(0,r.kt)("p",null,"... where the position-camel-libs module may have similar dependencies to the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'    api("org.apache.camel:camel-mail:3.14.2")\n    api("javax.mail:javax.mail-api:1.6.2")\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Next, add the service definition to the {applicationName}-service-definitions.xml file:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'<configuration>\n    ...\n    <service host="localhost" name="ALPHA_CAMEL" port="11006"/>\n</configuration>\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Create a Kotlin script file named ",(0,r.kt)("strong",{parentName:"li"},"{applicationName}-camel.kts")," file. It defines a single route using a range of Camel configuration options, which we'll explore in a little more detail below:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'camel {\n    routeHandler {\n        val pathStr = "${GenesisPaths.genesisHome()}/runtime/inbound/"\n        from("file:${pathStr}/exampledir/?move=.camel/\\${date:now:yyyyMMdd-HHmmssSSS}-\\${headers.CamelFileName}&initialDelay=5000&readLock=changed&readLockCheckInterval=5000&readLockTimeout=60000")\n            .process(fileEventProcessorProvider.createProcessor("EXAMPLE_EVENT_HANDLER", "EVENT_FILE_IMPORT_EXAMPLE", "FILE", "SOURCE_NAME"))\n    }\n}\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"routeHandler")," defines the possible routes for information to flow into and out of our system.  The example above defines one route. First, it defines the ",(0,r.kt)("inlineCode",{parentName:"p"},"pathStr")," using the ",(0,r.kt)("inlineCode",{parentName:"p"},"GenesisPaths")," class to find the ",(0,r.kt)("inlineCode",{parentName:"p"},"GENESIS_HOME")," system environment variable. Next, it defines the route itself. The route in the example comes from the filesystem determined by the ",(0,r.kt)("inlineCode",{parentName:"p"},"file:")," specifier at the start of the string. This could be any ",(0,r.kt)("a",{parentName:"p",href:"https://camel.apache.org/components/3.16.x/index.html"},"Apache Camel component")," that can act as a ",(0,r.kt)("a",{parentName:"p",href:"https://camel.apache.org/manual/camelcontext.html#_consumer"},"consumer"),". Further ",(0,r.kt)("inlineCode",{parentName:"p"},"routeHandler")," parameters and explanation can be found ",(0,r.kt)("a",{parentName:"p",href:"/server/integration/apache-camel/basics/#routehandler"},"here"),"."),(0,r.kt)("h4",{id:"exercise-52-reading-and-writing-using-an-sftp-server"},"Exercise 5.2 Reading and writing using an SFTP server"),(0,r.kt)("admonition",{title:"ESTIMATED TIME",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"45 mins")),(0,r.kt)("p",null,"It is your time! Use the Camel module build a Reading and Writing structure using an ",(0,r.kt)("a",{parentName:"p",href:"https://camel.apache.org/components/3.16.x/sftp-component.html"},"SFTP")," server. "),(0,r.kt)("p",null,"You can use any SFTP public server available to do that. ",(0,r.kt)("a",{parentName:"p",href:"https://www.sftp.net/public-online-sftp-servers"},"Here")," are some options."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Use properties set in the ",(0,r.kt)("em",{parentName:"p"},"application"),(0,r.kt)("strong",{parentName:"p"},"-camel.kts"),", allowing you to have site-specific variables for each instance. This is particularly useful when integrating with external services where connection details are likely to vary between environments."),(0,r.kt)("p",{parentName:"admonition"},"You can see some samples ",(0,r.kt)("a",{parentName:"p",href:"https://camel.apache.org/components/3.18.x/ftp-component.html#_samples"},"here"),". ")),(0,r.kt)("h2",{id:"data-pipeline"},"Data Pipeline"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Feature included in the Genesis low-code platform version 6.1.1")),(0,r.kt)("p",null,"You can define data pipelines that map data from an external source (database, file) to ",(0,r.kt)("a",{parentName:"p",href:"/database/fields-tables-views/tables/"},"Tables")," in your application. By default, the resulting table objects are stored in the database. However, you can define ",(0,r.kt)("a",{parentName:"p",href:"/server/integration/data-pipeline/advanced/#custom-handler-for-the-mapped-entity"},"custom operations")," as well."),(0,r.kt)("p",null,"Each data pipeline defines a source for the data and how that data is mapped to each ",(0,r.kt)("a",{parentName:"p",href:"/database/fields-tables-views/fields/"},"Field")," in the Table. If a field mapping is not one-to-one - e.g. complex type conversions, data obfuscation, enriched values - you can define a ",(0,r.kt)("inlineCode",{parentName:"p"},"transform")," function that has a return value that is mapped to the required field."),(0,r.kt)("p",null,"Once your Genesis application is running, data ingestion will take place."),(0,r.kt)("p",null,"Currently, the supported sources are: ",(0,r.kt)("em",{parentName:"p"},"PostgreSQL"),", ",(0,r.kt)("em",{parentName:"p"},"MS SQL Server"),", ",(0,r.kt)("em",{parentName:"p"},"Oracle Enterprise"),", and ",(0,r.kt)("em",{parentName:"p"},"Files")," that originate from the local filesystem or S3 (CSV, XML, JSON). The parameters and sample usage for each supported data source can be found ",(0,r.kt)("a",{parentName:"p",href:"/server/integration/data-pipeline/basics/#data-source"},"here"),"."),(0,r.kt)("h3",{id:"configuration-1"},"Configuration"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add the configuration for the Camel module to the {applicationName}-processes.xml file:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'<processes>\n    <process name="DATAPIPELINE_SANDBOX">\n        <groupId>data-pipeline</groupId>\n        <start>true</start>\n        <options>-Xmx1024m</options>\n        <module>genesis-pal-datapipeline</module>\n        <script>alpha-datapipeline.kts<\/script>\n        <description>Trades execution</description>\n        <language>pal</language>\n        <loggingLevel>TRACE,DATADUMP_ON</loggingLevel>\n    </process>\n</processes>\n')),(0,r.kt)("p",null,"... where the position-camel-libs module has similar dependencies to the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'    api("org.apache.camel:camel-mail:3.14.2")\n    api("javax.mail:javax.mail-api:1.6.2")\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Next, add the service definition to the {applicationName}",(0,r.kt)("strong",{parentName:"li"},"-service-definitions.xml")," file:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'<configuration>\n    ...\n    <service host="localhost" name="DATAPIPELINE_SANDBOX" port="11007"/>\n</configuration>\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Create a Kotlin script file named ",(0,r.kt)("strong",{parentName:"li"},"{applicationName}-datapipeline.kts")," file. Here is a sample configuration using ",(0,r.kt)("em",{parentName:"li"},"PostgreSQL"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'sources {\n\n    postgres("cdc-test") {\n        hostname = "localhost"\n        port = 5432\n        username = "postgres"\n        password = "docker"\n        databaseName = "postgres"\n\n        table {\n            "public.source_trades" to mapper("incoming_trades", TRADE) {\n                val tradeId = stringValue("trd_id")\n                val tradedAt = longValue("traded_at")\n\n                TRADE {\n\n                    TRADE_TYPE {\n                        sourceProperty = "side"\n                    }\n\n                    TRADE_DATE {\n                        transform {\n                            DateTime(input.get(tradedAt))\n                        }\n                    }\n\n                    RECORD_ID {\n                        transform {\n                            input.get(tradeId).removePrefix("ITS_").toLong()\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n')),(0,r.kt)("h4",{id:"exercise-53-reading-and-writing-using-an-sftp-server"},"Exercise 5.3 Reading and writing using an SFTP server"),(0,r.kt)("admonition",{title:"ESTIMATED TIME",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"30 mins")),(0,r.kt)("p",null,"We are now creating  a Data Pipeline to ingest trades using CSV. To do that, consider the same layout we showed in the ",(0,r.kt)("em",{parentName:"p"},"PostgreSQL")," configuration."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Check the CSV options ",(0,r.kt)("a",{parentName:"p",href:"/server/integration/data-pipeline/basics/#csv"},"here"),".")))}g.isMDXComponent=!0}}]);