"use strict";(self.webpackChunk_genesislcap_docs=self.webpackChunk_genesislcap_docs||[]).push([[91592],{38930:function(e,t,s){s.r(t),s.d(t,{assets:function(){return u},contentTitle:function(){return o},default:function(){return m},frontMatter:function(){return i},metadata:function(){return p},toc:function(){return c}});var a=s(87462),n=s(63366),r=(s(67294),s(3905)),l=(s(61839),["components"]),i={title:"Pipeline setup - Microsoft SQL Server",sidebar_label:"Microsoft SQL Server",id:"mssql",sidebar_position:3,keywords:["operations","pipeline","setup","mssql","microsoft","sql server"],tags:["operations","pipeline","setup","mssql","microsoft","sql server"]},o=void 0,p={unversionedId:"operations/pipeline-setup/mssql",id:"version-2022.3/operations/pipeline-setup/mssql",title:"Pipeline setup - Microsoft SQL Server",description:"CDC capabilities are only supported by MS SQL Server 2016 and later Standard and Enterprise editions. Ensure that your MS SQL instance is the Standard or Enterprise version before continuing.",source:"@site/versioned_docs/version-2022.3/05_operations/09_pipeline-setup/mssql.md",sourceDirName:"05_operations/09_pipeline-setup",slug:"/operations/pipeline-setup/mssql",permalink:"/operations/pipeline-setup/mssql",draft:!1,tags:[{label:"operations",permalink:"/tags/operations"},{label:"pipeline",permalink:"/tags/pipeline"},{label:"setup",permalink:"/tags/setup"},{label:"mssql",permalink:"/tags/mssql"},{label:"microsoft",permalink:"/tags/microsoft"},{label:"sql server",permalink:"/tags/sql-server"}],version:"2022.3",sidebarPosition:3,frontMatter:{title:"Pipeline setup - Microsoft SQL Server",sidebar_label:"Microsoft SQL Server",id:"mssql",sidebar_position:3,keywords:["operations","pipeline","setup","mssql","microsoft","sql server"],tags:["operations","pipeline","setup","mssql","microsoft","sql server"]},sidebar:"operationsSidebar",previous:{title:"PostgreSQL",permalink:"/operations/pipeline-setup/postgres"},next:{title:"Oracle DB",permalink:"/operations/pipeline-setup/oracle"}},u={},c=[{value:"Enable the SQL server agent",id:"enable-the-sql-server-agent",level:3},{value:"MS SQL in Docker",id:"ms-sql-in-docker",level:4},{value:"Remote shell on running instance",id:"remote-shell-on-running-instance",level:4},{value:"SQL Server Management Studio",id:"sql-server-management-studio",level:4},{value:"Create a database",id:"create-a-database",level:3},{value:"Enable CDC on the database",id:"enable-cdc-on-the-database",level:3},{value:"Create a table",id:"create-a-table",level:3},{value:"Enable CDC on the table",id:"enable-cdc-on-the-table",level:3},{value:"Verify that the user has access to CDC table",id:"verify-that-the-user-has-access-to-cdc-table",level:3}],d={toc:c};function m(e){var t=e.components,s=(0,n.Z)(e,l);return(0,r.kt)("wrapper",(0,a.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"CDC capabilities are only supported by MS SQL Server 2016 and later Standard and Enterprise editions. Ensure that your MS SQL instance is the Standard or Enterprise version before continuing.")),(0,r.kt)("h3",{id:"enable-the-sql-server-agent"},"Enable the SQL server agent"),(0,r.kt)("h4",{id:"ms-sql-in-docker"},"MS SQL in Docker"),(0,r.kt)("p",null,"When using an MS SQL docker image, pass the environment variable ",(0,r.kt)("inlineCode",{parentName:"p"},"MSSQL_AGENT_ENABLED=true")," on start-up to ensure that the SQL agent is running."),(0,r.kt)("h4",{id:"remote-shell-on-running-instance"},"Remote shell on running instance"),(0,r.kt)("p",null,"Remote into the instance and open a bash terminal as the root user. Enable the agent via the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/opt/mssql/bin/mssql-conf set sqlagent.enabled true\n")),(0,r.kt)("h4",{id:"sql-server-management-studio"},"SQL Server Management Studio"),(0,r.kt)("p",null,"Use the following documentation to ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/sql/ssms/agent/start-stop-or-pause-the-sql-server-agent-service?view=sql-server-ver16"},"Start, Stop, or Pause the service"),"."),(0,r.kt)("h3",{id:"create-a-database"},"Create a database"),(0,r.kt)("p",null,"For CDC to occur, you must have a database within your MS SQL server instance."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE TestDB\n")),(0,r.kt)("h3",{id:"enable-cdc-on-the-database"},"Enable CDC on the database"),(0,r.kt)("p",null,"Make sure "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"you are a member of sysadmin"),(0,r.kt)("li",{parentName:"ul"},"you are the db_owner of the database"),(0,r.kt)("li",{parentName:"ul"},"the SQL Server Agent is running")),(0,r.kt)("p",null,"Using ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/sql/ssms/scripting/sqlcmd-run-transact-sql-script-files?view=sql-server-ver16"},"Transact-SQL"),", run the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"USE MyDB\nGO\nEXEC sys.sp_cdc_enable_db\nGO\n")),(0,r.kt)("p",null,"For more information on how to execute ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/sql/ssms/scripting/sqlcmd-run-transact-sql-script-files?view=sql-server-ver16"},"Transact-SQL")," queries, look ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/sql/ssms/scripting/sqlcmd-run-transact-sql-script-files?view=sql-server-ver16"},"here"),"."),(0,r.kt)("p",null,"Once successful, you should see a schema with name ",(0,r.kt)("inlineCode",{parentName:"p"},"cdc")," and the ",(0,r.kt)("inlineCode",{parentName:"p"},"CDC")," user, metadata tables and other system objects."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The SQL Server CDC feature processes changes that occur in user-created tables only. You cannot enable CDC on the SQL Server master database.")),(0,r.kt)("h3",{id:"create-a-table"},"Create a table"),(0,r.kt)("p",null,"Simple SQL:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE accounts (user_id int PRIMARY KEY,username varchar ( 50 ) UNIQUE NOT NULL,password varchar ( 50 ) NOT NULL,email varchar ( 255 ) UNIQUE NOT NULL)\n")),(0,r.kt)("h3",{id:"enable-cdc-on-the-table"},"Enable CDC on the table"),(0,r.kt)("p",null,"Make sure "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"you are a member of sysadmin"),(0,r.kt)("li",{parentName:"ul"},"you are the db_owner of the database"),(0,r.kt)("li",{parentName:"ul"},"the SQL Server Agent is running")),(0,r.kt)("p",null,"Using ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/sql/ssms/scripting/sqlcmd-run-transact-sql-script-files?view=sql-server-ver16"},"Transact-SQL"),", run the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"USE MyDB\nGO\n\nEXEC sys.sp_cdc_enable_table\n@source_schema = N'dbo',\n@source_name   = N'accounts',\n@role_name     = N'sa',\n// @filegroup_name = N'MyDB_CT', - Set to null (or don't set) and the default \n//                                 filegroup will be used\n@supports_net_changes = 0\nGO\n")),(0,r.kt)("h3",{id:"verify-that-the-user-has-access-to-cdc-table"},"Verify that the user has access to CDC table"),(0,r.kt)("p",null,"An optional step; run the following stored procedure using Transact-SQL. Ensure that the response is not empty."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"USE MyDB;\nGO\nEXEC sys.sp_cdc_help_change_data_capture\nGO\n")))}m.isMDXComponent=!0}}]);