"use strict";(self.webpackChunk_genesislcap_docs=self.webpackChunk_genesislcap_docs||[]).push([[66253],{31310:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return g},frontMatter:function(){return o},metadata:function(){return d},toc:function(){return u}});var a=n(87462),r=n(63366),s=(n(67294),n(3905)),i=(n(61839),["components"]),o={title:"Go to the next level - User interaction using Data Servers, Request Servers and Event Handlers",sidebar_label:"User interaction",id:"events",keywords:["getting started","quick start","next level","user interaction","events"],tags:["getting started","quick start","next level","introduction","user interaction","events"]},l=void 0,d={unversionedId:"getting-started/go-to-the-next-level/events",id:"version-2022.3/getting-started/go-to-the-next-level/events",title:"Go to the next level - User interaction using Data Servers, Request Servers and Event Handlers",description:"Now that we have our data model defined, we can start adding the capabilities to read and create entries.",source:"@site/versioned_docs/version-2022.3/01_getting-started/03_go-to-the-next-level/04_events.md",sourceDirName:"01_getting-started/03_go-to-the-next-level",slug:"/getting-started/go-to-the-next-level/events",permalink:"/getting-started/go-to-the-next-level/events",draft:!1,tags:[{label:"getting started",permalink:"/tags/getting-started"},{label:"quick start",permalink:"/tags/quick-start"},{label:"next level",permalink:"/tags/next-level"},{label:"introduction",permalink:"/tags/introduction"},{label:"user interaction",permalink:"/tags/user-interaction"},{label:"events",permalink:"/tags/events"}],version:"2022.3",sidebarPosition:4,frontMatter:{title:"Go to the next level - User interaction using Data Servers, Request Servers and Event Handlers",sidebar_label:"User interaction",id:"events",keywords:["getting started","quick start","next level","user interaction","events"],tags:["getting started","quick start","next level","introduction","user interaction","events"]},sidebar:"learningSidebar",previous:{title:"Add some data",permalink:"/getting-started/go-to-the-next-level/add-some-data"},next:{title:"Data Grid",permalink:"/getting-started/go-to-the-next-level/data-grid"}},p={},u=[{value:"Section objectives",id:"section-objectives",level:2},{value:"Data Server",id:"data-server",level:2},{value:"Event Handler",id:"event-handler",level:2},{value:"Request Server",id:"request-server",level:2},{value:"Prepare the server and build",id:"prepare-the-server-and-build",level:2},{value:"Conclusion",id:"conclusion",level:2}],c={toc:u};function g(e){var t=e.components,o=(0,r.Z)(e,i);return(0,s.kt)("wrapper",(0,a.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"Now that we have our data model defined, we can start adding the capabilities to read and create entries."),(0,s.kt)("h2",{id:"section-objectives"},"Section objectives"),(0,s.kt)("p",null,"The goal of this section is to define and build:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"an Event Handler for creating trades "),(0,s.kt)("li",{parentName:"ul"},"a Data Server for reading positions and trades")),(0,s.kt)("h2",{id:"data-server"},"Data Server"),(0,s.kt)("p",null,"The component that enables data to be read in real time is called the ",(0,s.kt)("a",{parentName:"p",href:"/server/data-server/introduction/"},"Data Server"),". All the queries that a Data Server executes are defined in ",(0,s.kt)("strong",{parentName:"p"},"positions-app-tutorial-dataserver.kts"),". A Data Server can query both tables and views, so let's add two queries:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"ALL_POSITIONS")," - this queries the ",(0,s.kt)("inlineCode",{parentName:"li"},"POSITION")," table and returns the data stored in the table"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"ALL_TRADES")," - this queries the ",(0,s.kt)("inlineCode",{parentName:"li"},"TRADE_VIEW")," and returns the joined data stored in the ",(0,s.kt)("inlineCode",{parentName:"li"},"TRADE"),", ",(0,s.kt)("inlineCode",{parentName:"li"},"INSTRUMENT")," and ",(0,s.kt)("inlineCode",{parentName:"li"},"COUNTERPARTY")," tables")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-kotlin"},'dataServer {\n    query("ALL_POSITIONS", POSITION)\n    query("ALL_TRADES", TRADE_VIEW)\n}\n')),(0,s.kt)("h2",{id:"event-handler"},"Event Handler"),(0,s.kt)("p",null,"Next, we want to be able to insert rows into our table. For this, you need to define an ",(0,s.kt)("a",{parentName:"p",href:"/server/event-handler/introduction/"},"Event Handler")," in the file ",(0,s.kt)("strong",{parentName:"p"},"positions-app-tutorial-eventhandler.kts"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-kotlin"},'eventHandler {\n\n    eventHandler<Trade>(name = "TRADE_INSERT") {\n        onCommit { event ->\n            entityDb.insert(event.details)\n            ack()\n        }\n    }\n}\n')),(0,s.kt)("admonition",{title:"What is entityDb?",type:"info"},(0,s.kt)("p",{parentName:"admonition"},"The ",(0,s.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/"},"entityDb")," enables you to interact with the database layer. It's part of the Genesis database API and we'll get into more details soon. For now, understand that this is the common way to access data from code. Feel free to use the intellisense of your IDE to explore the methods available from entityDb.")),(0,s.kt)("h2",{id:"request-server"},"Request Server"),(0,s.kt)("p",null,"Predominantly used for serving the UI, Request Servers retrieve a snapshot of data from your tables/views on demand."),(0,s.kt)("p",null,"We will be using the following Request Server when we build the front end. Add the following simple code to the file ",(0,s.kt)("strong",{parentName:"p"},"positions-app-tutorial-reqrep.kts")," and we will mention this in a later section."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-kotlin"},"requestReplies {\n    requestReply(INSTRUMENT)\n}\n")),(0,s.kt)("h2",{id:"prepare-the-server-and-build"},"Prepare the server and build"),(0,s.kt)("p",null,"So far we have created an Event Handler and Data Server - just their definitions, but there's nothing on the runtime configuration yet. Each component, such as Event Handler and Data Server, must run on their own processes. To do that, we have to change the processes and the service definition files:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"positions-app-tutorial-processes.xml")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"positions-app-tutorial-service-definitions.xml"))),(0,s.kt)("p",null,"At present, they are empty. You need to insert the details of the Data Server and Event Handler that you have just created."),(0,s.kt)("p",null,"Add the following content to the ",(0,s.kt)("strong",{parentName:"p"},"positions-app-tutorial-processes.xml")," file."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-xml"},'<processes>\n    <process name="POSITIONS_APP_TUTORIAL_DATASERVER">\n        <groupId>POSITIONS_APP_TUTORIAL</groupId>\n        <start>true</start>\n        <options>-Xmx1024m -DXSD_VALIDATE=false</options>\n        <module>genesis-pal-dataserver</module>\n        <package>global.genesis.dataserver.pal</package>\n        <script>positions-app-tutorial-dataserver.kts<\/script>\n        <description>Displays real-time details</description>\n        <language>pal</language>\n        <loggingLevel>DEBUG,DATADUMP_ON</loggingLevel>\n    </process>\n    <process name="POSITIONS_APP_TUTORIAL_EVENT_HANDLER">\n        <groupId>POSITIONS_APP_TUTORIAL</groupId>\n        <start>true</start>\n        <options>-Xmx256m -DRedirectStreamsToLog=true -DXSD_VALIDATE=false</options>\n        <module>genesis-pal-eventhandler</module>\n        <package>global.genesis.eventhandler.pal</package>\n        <script>positions-app-tutorial-eventhandler.kts<\/script>\n        <description>Handles events</description>\n        <classpath>positions-app-tutorial-messages*,positions-app-tutorial-eventhandler*</classpath>\n        <language>pal</language>\n    </process>\n    <process name="POSITIONS_APP_TUTORIAL_REQUEST_SERVER">\n        <groupId>POSITIONS_APP_TUTORIAL</groupId>\n        <start>true</start>\n        <options>-Xmx256m -DRedirectStreamsToLog=true -DXSD_VALIDATE=false</options>\n        <module>genesis-pal-requestserver</module>\n        <package>global.genesis.requestreply.pal</package>\n        <script>positions-app-tutorial-reqrep.kts<\/script>\n        <description>Server one-shot requests for details</description>\n        <language>pal</language>\n    </process>\n</processes>\n')),(0,s.kt)("p",null,"Add the following content to the ",(0,s.kt)("strong",{parentName:"p"},"positions-app-tutorial-service-definitions.xml")," file."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-xml"},'<configuration>\n    <service host="localhost" name="POSITIONS_APP_TUTORIAL_DATASERVER" port="11000"/>\n    <service host="localhost" name="POSITIONS_APP_TUTORIAL_EVENT_HANDLER" port="11001"/>\n    <service host="localhost" name="POSITIONS_APP_TUTORIAL_REQUEST_SERVER" port="11002"/>\n</configuration>\n')),(0,s.kt)("p",null,"See ",(0,s.kt)("a",{parentName:"p",href:"/server/configuring-runtime/processes/"},"here")," for a detailed description of the processes configuration. Finally, you can build the server."),(0,s.kt)("p",null,"From the Gradle menu on the right of Intellij, this is: ",(0,s.kt)("strong",{parentName:"p"},"genesisproduct-positions-app-tutorial"),"/",(0,s.kt)("strong",{parentName:"p"},"Tasks"),"/",(0,s.kt)("strong",{parentName:"p"},"build/assemble"),"."),(0,s.kt)("p",null,(0,s.kt)("img",{src:n(12193).Z,width:"421",height:"474"})),(0,s.kt)("admonition",{title:"HTTP Endpoints",type:"info"},(0,s.kt)("p",{parentName:"admonition"}," It's important to note that most resources, such as Event Handlers and Data Servers, are exposed as ",(0,s.kt)("a",{parentName:"p",href:"/server/integration/rest-endpoints/introduction/"},"HTTP endpoints")," automatically by the Genesis platform - without any additional code. This enables you to test those resources from HTTP clients, such as Postman. Alternatively, you can use Genesis Console, which gives you a simple way of testing components from a nice web UI.")),(0,s.kt)("h2",{id:"conclusion"},"Conclusion"),(0,s.kt)("p",null,"Data Server and Event Handler are the main components to interact with the server. Now that we have built our back end, we have something to interact with. Once you have deployed it, if you want to test what you've done so far, go to ",(0,s.kt)("a",{parentName:"p",href:"/server/integration/rest-endpoints/introduction/"},"Endpoints"),"."),(0,s.kt)("p",null,"Otherwise, you can continue to the ",(0,s.kt)("a",{parentName:"p",href:"/getting-started/go-to-the-next-level/data-grid/"},"next section")," and deploy and test the whole application at later time."))}g.isMDXComponent=!0},12193:function(e,t,n){t.Z=n.p+"assets/images/assemble-server-positions-c3048c8150923c0a120f17fee610c4d7.png"}}]);