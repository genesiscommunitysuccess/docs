"use strict";(self.webpackChunk_genesislcap_docs=self.webpackChunk_genesislcap_docs||[]).push([[8049],{85162:function(e,t,a){a.d(t,{Z:function(){return s}});var n=a(67294),i=a(86010),r="tabItem_Ymn6";function s(e){var t=e.children,a=e.hidden,s=e.className;return n.createElement("div",{role:"tabpanel",className:(0,i.Z)(r,s),hidden:a},t)}},65488:function(e,t,a){a.d(t,{Z:function(){return c}});var n=a(87462),i=a(67294),r=a(86010),s=a(72389),l=a(67392),o=a(7094),d=a(12466),p="tabList__CuJ",u="tabItem_LNqP";function m(e){var t,a,s=e.lazy,m=e.block,c=e.defaultValue,h=e.values,g=e.groupId,v=e.className,b=i.Children.map(e.children,(function(e){if((0,i.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),k=null!=h?h:b.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),y=(0,l.l)(k,(function(e,t){return e.value===t.value}));if(y.length>0)throw new Error('Docusaurus error: Duplicate values "'+y.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var f=null===c?c:null!=(t=null!=c?c:null==(a=b.find((function(e){return e.props.default})))?void 0:a.props.value)?t:b[0].props.value;if(null!==f&&!k.some((function(e){return e.value===f})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+f+'" but none of its children has the corresponding value. Available values are: '+k.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var N=(0,o.U)(),T=N.tabGroupChoices,E=N.setTabGroupChoices,x=(0,i.useState)(f),w=x[0],D=x[1],C=[],I=(0,d.o5)().blockElementScrollPositionUntilNextRender;if(null!=g){var A=T[g];null!=A&&A!==w&&k.some((function(e){return e.value===A}))&&D(A)}var S=function(e){var t=e.currentTarget,a=C.indexOf(t),n=k[a].value;n!==w&&(I(t),D(n),null!=g&&E(g,String(n)))},_=function(e){var t,a=null;switch(e.key){case"ArrowRight":var n,i=C.indexOf(e.currentTarget)+1;a=null!=(n=C[i])?n:C[0];break;case"ArrowLeft":var r,s=C.indexOf(e.currentTarget)-1;a=null!=(r=C[s])?r:C[C.length-1]}null==(t=a)||t.focus()};return i.createElement("div",{className:(0,r.Z)("tabs-container",p)},i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":m},v)},k.map((function(e){var t=e.value,a=e.label,s=e.attributes;return i.createElement("li",(0,n.Z)({role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,key:t,ref:function(e){return C.push(e)},onKeyDown:_,onFocus:S,onClick:S},s,{className:(0,r.Z)("tabs__item",u,null==s?void 0:s.className,{"tabs__item--active":w===t})}),null!=a?a:t)}))),s?(0,i.cloneElement)(b.filter((function(e){return e.props.value===w}))[0],{className:"margin-top--md"}):i.createElement("div",{className:"margin-top--md"},b.map((function(e,t){return(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==w})}))))}function c(e){var t=(0,s.Z)();return i.createElement(m,(0,n.Z)({key:String(t)},e))}},88857:function(e,t,a){a.r(t),a.d(t,{assets:function(){return m},contentTitle:function(){return p},default:function(){return g},frontMatter:function(){return d},metadata:function(){return u},toc:function(){return c}});var n=a(87462),i=a(63366),r=(a(67294),a(3905)),s=(a(61839),a(65488)),l=a(85162),o=["components"],d={title:"Server Specialist Developer Training - Day one",sidebar_label:"Day one",sidebar_position:2,id:"01_ssdt-day1",keywords:["getting started","developer training","server training","day one"],tags:["getting started","developer training","server training","day one"]},p=void 0,u={unversionedId:"getting-started/server_training/01_ssdt-day1",id:"getting-started/server_training/01_ssdt-day1",title:"Server Specialist Developer Training - Day one",description:"This day covers:",source:"@site/docs/01_getting-started/09_server_training/01_ssdt-day1.md",sourceDirName:"01_getting-started/09_server_training",slug:"/getting-started/server_training/01_ssdt-day1",permalink:"/next/getting-started/server_training/01_ssdt-day1",draft:!1,tags:[{label:"getting started",permalink:"/next/tags/getting-started"},{label:"developer training",permalink:"/next/tags/developer-training"},{label:"server training",permalink:"/next/tags/server-training"},{label:"day one",permalink:"/next/tags/day-one"}],version:"current",sidebarPosition:2,frontMatter:{title:"Server Specialist Developer Training - Day one",sidebar_label:"Day one",sidebar_position:2,id:"01_ssdt-day1",keywords:["getting started","developer training","server training","day one"],tags:["getting started","developer training","server training","day one"]},sidebar:"learningSidebar",previous:{title:"Getting Started",permalink:"/next/getting-started/server_training/ssdt-getting_started"},next:{title:"Day two",permalink:"/next/getting-started/server_training/01_ssdt-day2"}},m={},c=[{value:"System definitions\u200b",id:"system-definitions",level:2},{value:"Global, System and Host levels",id:"global-system-and-host-levels",level:3},{value:"Items defined",id:"items-defined",level:3},{value:"Exercise 1.1 System Definitions",id:"exercise-11-system-definitions",level:4},{value:"Advanced Event Handlers",id:"advanced-event-handlers",level:2},{value:"Database API",id:"database-api",level:3},{value:"Syntax",id:"syntax",level:4},{value:"Exercise 1.2 entityDb ReadOperation getBulk",id:"exercise-12-entitydb-readoperation-getbulk",level:4},{value:"Exception handling",id:"exception-handling",level:3},{value:"Exercise 1.3 Exception handling",id:"exercise-13-exception-handling",level:4},{value:"Custom reply message type",id:"custom-reply-message-type",level:3},{value:"onException",id:"onexception",level:4},{value:"Exercise 1.4 Event Handler custom message",id:"exercise-14-event-handler-custom-message",level:4}],h={toc:c};function g(e){var t=e.components,a=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,n.Z)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This day covers:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#system-definitions"},"System definitions\u200b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#advanced-event-handlers"},"Advanced Event Handlers"))),(0,r.kt)("h2",{id:"system-definitions"},"System definitions\u200b"),(0,r.kt)("p",null,"The system definition file ",(0,r.kt)("strong",{parentName:"p"},"genesis-system-definition.kts")," is the basis of all configurations, scripts, data model, etc. This section explains all the different items that are contained in the file."),(0,r.kt)("p",null,"Here is an example of a ",(0,r.kt)("strong",{parentName:"p"},"genesis-system-definition.kts")," file for an application:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'package genesis.cfg\n\nsystemDefinition {\n    global {\n        item(name = "MqLayer", value = "ZeroMQ")\n        item(name = "DbLayer", value = "FDB")\n        item(name = "DictionarySource", value = "DB")\n        item(name = "AliasSource", value = "DB")\n        item(name = "MetricsEnabled", value = "false")\n\n        item(name = "ZeroMQProxyInboundPort", value = "5001")\n        item(name = "ZeroMQProxyOutboundPort", value = "5000")\n\n        item(name = "DbHost", value = "localhost")\n        item(name = "DbMode", value = "VANILLA")\n        item(name = "GenesisNetProtocol", value = "V2")\n        item(name = "ResourcePollerTimeout", value = "5")\n        item(name = "ReqRepTimeout", value = "60")\n        item(name = "MetadataChronicleMapAverageKeySizeBytes", value = "128")\n        item(name = "MetadataChronicleMapAverageValueSizeBytes", value = "1024")\n        item(name = "MetadataChronicleMapEntriesCount", value = "512")\n        item(name = "DaemonServerPort", value = "4568")\n        item(\n            name = "JVM_OPTIONS",\n            value = "-XX:MaxHeapFreeRatio=70 -XX:MinHeapFreeRatio=30 -XX:+UseG1GC -XX:+UseStringDeduplication -XX:OnOutOfMemoryError=\\"handleOutOfMemoryError.sh %p\\""\n        )\n    }\n\n    systems {\n        system(name = "DEV") {\n            hosts {\n                host(name = "genesis-serv")\n            }\n\n            item(name = "DbNamespace", value = "genesis")\n            item(name = "ClusterPort", value = "6000")\n            item(name = "Location", value = "LO")\n            item(name = "LogFramework", value = "LOG4J2")\n            item(name = "LogFrameworkConfig", value = "log4j2-default.xml")\n        }\n    }\n}\n')),(0,r.kt)("h3",{id:"global-system-and-host-levels"},"Global, System and Host levels"),(0,r.kt)("p",null,"As you can see from the example, you can define items at global, system and host level."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Global"),": These properties will be available to all systems. "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"System"),": These properties contain information about a particular system and can have a free text field. Each system is associated with a host or hosts. The content should specify the type of environment the system is running in.\nLocal values can be specified in this block. ",(0,r.kt)("strong",{parentName:"li"},"These values override the global values"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Host"),": In this section you can define properties of host or hosts (if running in a cluster environment). Host block can exist under the system section as shown in the above example.\nThe host name defines what environment you are running in. By default, only one host will be used and change its value to current machine hostname.")),(0,r.kt)("h3",{id:"items-defined"},"Items defined"),(0,r.kt)("p",null,"In the system definitions file, there are several items to be used as default values or even change configurations to adapt the application. "),(0,r.kt)("p",null,"For instance, to change the database configuration to any one of the ",(0,r.kt)("a",{parentName:"p",href:"/database/database-technology/overview/"},"technologies supported"),", you should change the items ",(0,r.kt)("inlineCode",{parentName:"p"},"DbLayer"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"DbHost"),", and possibly ",(0,r.kt)("inlineCode",{parentName:"p"},"system/hosts"),". The code bellow show us how we could do this."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:"{6,8,13-16}","{6,8,13-16}":!0},'package genesis.cfg\n\nsystemDefinition {\n    global {\n        ...\n        item(name = "DbLayer", value = "SQL")\n        ...\n        item(name = "DbHost", value = "jdbc:postgresql://localhost:5432/?user=postgres&password=")\n        ...\n    }\n\n    systems {\n        system(name = "DEV") {\n            hosts {\n                host(LOCAL_HOST)\n            }\n            ...\n        }\n    }\n}\n')),(0,r.kt)("p",null,"Additionally, it is possible to create a global custom definition to be used like the code bellow."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:"{3}","{3}":!0},'systemDefinition {\n    global {\n        item(name = "ADMIN_PERMISSION_ENTITY_FIELD", value = "COUNTERPARTY_ID")\n    }\n}\n')),(0,r.kt)("p",null,"The custom definition value will be available globally and can be accessed like this."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},"val permissionsField = SysDef.ADMIN_PERMISSION_ENTITY_FIELD\n")),(0,r.kt)("p",null,"Further information regarding the system definitions such as items defined, HashiCorp Vault, and more can be found ",(0,r.kt)("a",{parentName:"p",href:"/server/configuring-runtime/system-definitions/"},"here"),"."),(0,r.kt)("h4",{id:"exercise-11-system-definitions"},"Exercise 1.1 System Definitions"),(0,r.kt)("admonition",{title:"ESTIMATED TIME",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"20 mins")),(0,r.kt)("p",null,"Let\xb4s start the hands-on training with the first exercise. We are going to create a global custom definition to set the nullability for the Trade table fields. "),(0,r.kt)("p",null,"Create a new item in the system definition file and use it in the fields definition file."),(0,r.kt)("admonition",{title:"changing genesis-system-definition configurations ",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"To do this exercise, clone the Developer Training ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/genesiscommunitysuccess/devtraining-gama"},"repository"),", go to the file ",(0,r.kt)("strong",{parentName:"p"},"genesis-system-definition.kts")," and do the changes. Then, go to the fields definition file and set the ",(0,r.kt)("em",{parentName:"p"},"nullable")," using SysDef. "),(0,r.kt)("p",{parentName:"admonition"},"After the changes, don't forget to run ",(0,r.kt)("em",{parentName:"p"},"build"),", ",(0,r.kt)("em",{parentName:"p"},"install-site-specific")," and ",(0,r.kt)("em",{parentName:"p"},"deploy")," tasks.")),(0,r.kt)("h2",{id:"advanced-event-handlers"},"Advanced Event Handlers"),(0,r.kt)("p",null,"The Genesis low-code platform has a real-time event-driven architecture."),(0,r.kt)("p",null,"Applications built on the system must respond immediately to different types of input:\xa0inputs from users, messages from other systems, market-data updates and internally calculated analytic signals.\xa0These inputs are events."),(0,r.kt)("p",null,"All the business logic for applications built on the platform is structured around these events. When an event occurs, the business logic immediately fires into action."),(0,r.kt)("p",null,"As a rough guide, many of the tables you have created need ",(0,r.kt)("strong",{parentName:"p"},"Insert"),", ",(0,r.kt)("strong",{parentName:"p"},"Modify")," and ",(0,r.kt)("strong",{parentName:"p"},"Delete")," events, so that you can specify the processing that these events require. "),(0,r.kt)("p",null,"The vast majority of applications include business workflow. Event Handlers are conventionally defined in the file ",(0,r.kt)("em",{parentName:"p"},"application-name"),(0,r.kt)("strong",{parentName:"p"},"-eventhandler.kts"),". "),(0,r.kt)("p",null,"In the ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/developer-training/training-intro/"},"Developer Training")," we defined the application Event Handler in a ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/developer-training/training-content-day1/#event-handler"},"Kotlin script file"),"; this included basic things like ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/developer-training/training-content-day2/#exercise-22-extending-the-application"},"enabling the application to write to the database"),"."),(0,r.kt)("p",null,"There are more things we can explore now, such as ",(0,r.kt)("a",{parentName:"p",href:"#database-api"},"Database API"),", ",(0,r.kt)("a",{parentName:"p",href:"#exception-handling"},"Exception handling"),", and ",(0,r.kt)("a",{parentName:"p",href:"#custom-reply-message-type"},"Custom reply message type"),". These are described in the next sections."),(0,r.kt)("h3",{id:"database-api"},"Database API"),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/"},"entityDb")," enables you to interact with the database layer; you can use any generated type-safe entities for tables and views. The interface supports the same operations as the generated repositories, but will accept any entity. It supports read operations for views and tables and write operations for tables only."),(0,r.kt)("p",null,"The entityDb differs from the generated repositories in that it can handle any table and most view entities. The entityDb is available in the kotlin Event Handler. "),(0,r.kt)("p",null,"When referring to indices in the database operations, the database accepts ",(0,r.kt)("em",{parentName:"p"},"index classes")," or ",(0,r.kt)("em",{parentName:"p"},"entity class")," in combination with ",(0,r.kt)("em",{parentName:"p"},"index references"),". Further details and conventions can be found ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#type-convention"},"here"),"."),(0,r.kt)("p",null,"EntityDb offers Read and Write Operations. Using ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#read-operations"},"Read Operations")," it is possible to get a simple lookup on the database through the method ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#get"},"get"),", or even create a ",(0,r.kt)("a",{parentName:"p",href:"https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow/"},"Flow")," or ",(0,r.kt)("a",{parentName:"p",href:"http://reactivex.io/RxJava/3.x/javadoc/io/reactivex/rxjava3/core/Flowable.html"},"Flowable")," of the whole table as the code below."),(0,r.kt)("h4",{id:"syntax"},"Syntax"),(0,r.kt)(s.Z,{defaultValue:"kotlin",values:[{label:"Kotlin",value:"kotlin"},{label:"Java",value:"java"}],mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"kotlin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},"// we can pass in Trade as a type parameter\nval flow = db.getBulk<Trade>()\n// we can pass in the TRADE object\nval flow = db.getBulk(TRADE)\n// or we can pass in an index reference\nval flow = db.getBulk(Trade.ByTypeId)\n"))),(0,r.kt)(l.Z,{value:"java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// we can pass in Trade as a type parameter\nfinal var flowable = db.getBulk(Trade.class);\n// we can pass in the TRADE object\nfinal var flowable = db.getBulk(TRADE.INSTACE);\n// or we can pass in an index reference\nfinal var flowable = db.getBulk(Trade.ById.Companion);\n")))),(0,r.kt)("p",null,"On the other hand, ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#write-operations"},"Write Operations")," have versions that take a single entity and versions that take multiple entries. The return values for these operations are type-safe (see details below), provided all entries are of the same type. There are ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#default-and-generated-values"},"Default and generated values"),", as well as CRUD methods and variations: ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#insert"},"Insert"),", ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#modify"},"Modify"),", ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#upsert"},"Upsert"),", ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#delete"},"Delete"),", ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#update"},"Update")," as the code below. "),(0,r.kt)(s.Z,{defaultValue:"kotlin",values:[{label:"Kotlin",value:"kotlin"},{label:"Java",value:"java"}],mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"kotlin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'db.updateBy(Trade.byId("xxxxx")) {\n    price = 15.0\n}\n\ndb.updateByRange(Trade.byOrderId("xxxx")) {\n    orderStatus = OrderStatus.CANCELLED\n}\n\ndb.updateByRange(Trade.byOrderId("xxxx"), Trade.byOrderId("yyyy") {\n    orderStatus = OrderStatus.CANCELLED\n}\n\ndb.updateAll<Trade> {\n    orderStatus = OrderStatus.CANCELLED\n}\n'))),(0,r.kt)(l.Z,{value:"java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'db.updateBy(Trade.byId("xxx"), trade -> {\n    trade.setPrice(15.0);\n}).blockingGet();\n\ndb.updateByRange(Trade.byOrderId("xxxx"), trade -> {\n    trade.setTradeType(OrderStatus.CANCELLED);\n}).blockingGet();\n\ndb.updateByRange(Trade.byOrderId("xxxx"), Trade.byOrderId("yyyy"), trade -> {\n    trade.setTradeType(OrderStatus.CANCELLED);\n}).blockingGet();\n\ndb.updateAll(Trade.class, trade -> {\n    trade.setTradeType(OrderStatus.CANCELLED);\n}).blockingGet();\n')))),(0,r.kt)("p",null,"If the underlying database supports transactions, then the entityDb provides type-safe access to these. A read transaction will support the same read operations as the entity db, and a write transaction will support the same read and write operations. If a write transaction fails, all operations will be reverted. Subscribe operations are not supported within transactions. Currently, transactions are supported on ",(0,r.kt)("strong",{parentName:"p"},"FoundationDb")," and ",(0,r.kt)("strong",{parentName:"p"},"Postgresql"),". Using transaction on ",(0,r.kt)("strong",{parentName:"p"},"Aerospike")," will result in a failure. Further details regarding transactions can be found ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#transactions"},"here"),"."),(0,r.kt)("p",null,"Using entityDb, it is also possible to subscribe operations, starting a database listener that receives updates to tables or views. When subscribing to view updates, only updates to the root table will be published. Further details regarding subscribe operations can be found ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#subscribe-operations"},"here"),"."),(0,r.kt)("h4",{id:"exercise-12-entitydb-readoperation-getbulk"},"Exercise 1.2 entityDb ReadOperation getBulk"),(0,r.kt)("admonition",{title:"ESTIMATED TIME",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"40 mins")),(0,r.kt)("p",null,"Create a new event called ",(0,r.kt)("strong",{parentName:"p"},"TRADE_STANDARDIZATION")," to perform a standardization in the Trade table, setting all negative ",(0,r.kt)("em",{parentName:"p"},"Trade.Quantity")," records to zero. This method can use the ReadOperation ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#getbulk"},"getBulk")," method to list all Trades and then use the ",(0,r.kt)("a",{parentName:"p",href:"https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/filter.html"},"filter")," method Kotlin Flow class offers."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"After selecting the Trade records you can use the ",(0,r.kt)("em",{parentName:"p"},"forEach")," method to set the quantities to zero, and then use entityDb method ",(0,r.kt)("a",{parentName:"p",href:"/database/database-interface/entity-db/#modify"},"modifyAll")," to update everything.")),(0,r.kt)("h3",{id:"exception-handling"},"Exception handling"),(0,r.kt)("p",null,"In order to handle exceptions in Event Handlers, the traditional ",(0,r.kt)("inlineCode",{parentName:"p"},"try")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"catch")," options are available and ready for usage. "),(0,r.kt)("p",null,"For instance, handling exceptions in ",(0,r.kt)("em",{parentName:"p"},"EVENT_TRADE_INSERT")," can be something like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'eventHandler {\n    eventHandler<Trade>(name = "TRADE_INSERT") {\n        onCommit { event ->\n            try {\n                entityDb.insert(event.details)\n                ack()\n            }\n            catch (e: Exception) {\n                LOG.error("Error: $e")\n                nack(e)                \n            }\n        }\n    }\n}\n')),(0,r.kt)("h4",{id:"exercise-13-exception-handling"},"Exercise 1.3 Exception handling"),(0,r.kt)("admonition",{title:"ESTIMATED TIME",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"30 mins")),(0,r.kt)("p",null,"Add an exception handler in ",(0,r.kt)("em",{parentName:"p"},"EVENT_COUNTERPARTY_INSERT"),", logging and enriching the error message with the message as well as the cause and event name."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Don't forget the returns, in this case ",(0,r.kt)("inlineCode",{parentName:"p"},"ack()")," for success, and ",(0,r.kt)("inlineCode",{parentName:"p"},"nack(e)")," for exceptions.")),(0,r.kt)("h3",{id:"custom-reply-message-type"},"Custom reply message type"),(0,r.kt)("p",null,"If you use a custom reply message type, you won\u2019t be able to use the default ",(0,r.kt)("inlineCode",{parentName:"p"},"ack()")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"validationAck()")," functions.  The custom message type needs to be returned from the method."),(0,r.kt)("p",null,"For a custom message type called ",(0,r.kt)("inlineCode",{parentName:"p"},"TradeEvent")," defined as:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'data class TradeEvent(\n    val price: Double,\n    val quantity: Int,\n){\n    init{\n        require(price > 0) { "Price cannot be negative "}\n        require(quantity > 0) { "Quantity cannot be negative "}\n    }\n}\n')),(0,r.kt)("p",null,"... and  a custom message reply type called ",(0,r.kt)("inlineCode",{parentName:"p"},"CustomTradeEventReply")," defined as:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},"sealed class CustomTradeEventReply : Outbound() {\n    class TradeEventValidateAck : CustomTradeEventReply()\n    data class TradeEventAck(val tradeId: String) : CustomTradeEventReply()\n    data class TradeEventNack(val error: String) : CustomTradeEventReply()\n}\n")),(0,r.kt)("p",null,"... you could use the example Event Handler below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},'    eventHandler<TradeEvent, CustomTradeEventReply>(name = "CUSTOM_TRADE_EVENT") {\n        onException { event, throwable ->\n            TradeEventNack(throwable.message!!)\n        }\n        onValidate {\n            val tradeEvent = it.details\n            require((tradeEvent.price * tradeEvent.quantity.toDouble()) < 1_000_000) { "Trade notional is too high" }\n            TradeEventValidateAck()\n        }\n        onCommit { event ->\n            val trade = event.details\n            val result = entityDb.insert(trade)\n            TradeEventAck(result.record.tradeId)\n        }\n    }\n')),(0,r.kt)("h4",{id:"onexception"},"onException"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"onException")," block can capture any exceptions thrown by the ",(0,r.kt)("inlineCode",{parentName:"p"},"onValidate")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"onCommit")," blocks and returns the expected reply message type (as shown in the last example). This function is particularly useful if you are using a custom message type; by default, Event Handlers will attempt to translate exceptions automatically to an ",(0,r.kt)("strong",{parentName:"p"},"EventNack")," message, which might cause compatibility problems if you are using custom replies."),(0,r.kt)("h4",{id:"exercise-14-event-handler-custom-message"},"Exercise 1.4 Event Handler custom message"),(0,r.kt)("admonition",{title:"ESTIMATED TIME",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"30 mins")),(0,r.kt)("p",null,"Now let's change the EVENT_TRADE_INSERT to use a custom reply message type. Create the classes ",(0,r.kt)("inlineCode",{parentName:"p"},"CustomTradeEventReply ")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"TradeEvent")," with ",(0,r.kt)("em",{parentName:"p"},"price")," and ",(0,r.kt)("em",{parentName:"p"},"quantity")," required greater than zero. The Event Handler ",(0,r.kt)("inlineCode",{parentName:"p"},"onValidate")," should ensure that ",(0,r.kt)("em",{parentName:"p"},"price")," * ",(0,r.kt)("em",{parentName:"p"},"quantity")," is always greater than 10."))}g.isMDXComponent=!0}}]);