"use strict";(self.webpackChunk_genesislcap_docs=self.webpackChunk_genesislcap_docs||[]).push([[64546],{67444:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return c},frontMatter:function(){return o},metadata:function(){return m},toc:function(){return d}});var a=n(87462),i=n(63366),l=(n(67294),n(3905)),r=(n(61839),["components"]),o={title:"Notify - Email",sidebar_label:"Email",id:"email",keywords:["server","integration","notify","email"],tags:["server","integration","notify","email"]},s=void 0,m={unversionedId:"server/integration/notify/email",id:"server/integration/notify/email",title:"Notify - Email",description:"Email configuration",source:"@site/docs/03_server/10_integration/06_notify/02_email.md",sourceDirName:"03_server/10_integration/06_notify",slug:"/server/integration/notify/email",permalink:"/next/server/integration/notify/email",draft:!1,tags:[{label:"server",permalink:"/next/tags/server"},{label:"integration",permalink:"/next/tags/integration"},{label:"notify",permalink:"/next/tags/notify"},{label:"email",permalink:"/next/tags/email"}],version:"current",sidebarPosition:2,frontMatter:{title:"Notify - Email",sidebar_label:"Email",id:"email",keywords:["server","integration","notify","email"],tags:["server","integration","notify","email"]},sidebar:"serverModulesSidebar",previous:{title:"Configuring",permalink:"/next/server/integration/notify/configuring"},next:{title:"Symphony",permalink:"/next/server/integration/notify/symphony"}},u={},d=[{value:"Email configuration",id:"email-configuration",level:2},{value:"Using system definition in the notify.kts script",id:"using-system-definition-in-the-notifykts-script",level:2},{value:"Database configuration",id:"database-configuration",level:2},{value:"GATEWAY",id:"gateway",level:3},{value:"GATEWAY_VALUE JSON structure",id:"gateway_value-json-structure",level:3},{value:"NOTIFY_ROUTE",id:"notify_route",level:3},{value:"NOTIFY",id:"notify",level:3},{value:"NOTIFY.BODY JSON structure",id:"notifybody-json-structure",level:3}],p={toc:d};function c(e){var t=e.components,n=(0,i.Z)(e,r);return(0,l.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"email-configuration"},"Email configuration"),(0,l.kt)("p",null,"You can define the following configuration items in order to provide SMTP server connection details, and to configure email service-related features."),(0,l.kt)("p",null,"Include the following in your application's ",(0,l.kt)("strong",{parentName:"p"},"notify.kts")," file:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'notify {\n\n    // note: the connection \'id\' will default to \'email1\' if it\'s not specified, however if you have multiple connections\n    //       of the same type (in this case email) then it will need to be specified.\n    email(id = "email1") {\n    \n            // Default Linux Email SMTP Server\n            smtpHost = "localhost"\n            smtpPort = 587\n            smtpUser = "notifications@genesis.global"\n            smtpPw = ""\n            smtpProtocol = "SMTP_TLS"\n            systemDefaultUserName = "Genesis System"\n            systemDefaultEmail = "system@genesis.global"\n    }\n\n    // optionally include additional connections, including additional Symphony, Email\n}\n')),(0,l.kt)("h2",{id:"using-system-definition-in-the-notifykts-script"},"Using system definition in the notify.kts script"),(0,l.kt)("p",null,"Include the following in your aplication's ",(0,l.kt)("strong",{parentName:"p"},"genesis-system-definition.kts")," file:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'systemDefinition {\n    global {\n    \n            //Email Notify Details\n            item(name = "EMAIL_SYSTEM_DEFAULT_USER_NAME", value = "System Genesis" )\n            item(name = "EMAIL_SYSTEM_DEFAULT", value = "system@genesis.com" )\n            item(name = "EMAIL_SMTP_HOST", value = "localhost" )\n            item(name = "EMAIL_SMTP_PORT", value = "587" )\n            item(name = "EMAIL_SMTP_USER", value = "access@genesis.com" )\n            item(name = "EMAIL_SMTP_PW", "")\n        }\n}\n')),(0,l.kt)("p",null,"In the application's ",(0,l.kt)("strong",{parentName:"p"},"notify.kts")," file, you can refer to the item name directly, without import or qualifier:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-Kotlin"},'email(id = "email1") {\n\n    smtpHost = EMAIL_SMTP_HOST\n    smtpPort = EMAIL_SMTP_PORT\n    smtpUser = MAIL_SMTP_USER\n    smtpPw = EMAIL_SMTP_PW\n    smtpProtocol = "SMTP_TLS"\n    systemDefaultUserName = EMAIL_SYSTEM_DEFAULT_USER_NAME\n    systemDefaultEmail = EMAIL_SYSTEM_DEFAULT\n}\n')),(0,l.kt)("h2",{id:"database-configuration"},"Database configuration"),(0,l.kt)("h3",{id:"gateway"},"GATEWAY"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Usage"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"GATEWAY_ID"),(0,l.kt)("td",{parentName:"tr",align:null},"A Unique name for the gateway, which can be referenced in the NOTIFY_ROUTE")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"GATEWAY_TYPE"),(0,l.kt)("td",{parentName:"tr",align:null},'Set to "EmailDistribution"')),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"GATEWAY_VALUE"),(0,l.kt)("td",{parentName:"tr",align:null},"Static email distribution list specified for this gateway as a ",(0,l.kt)("a",{parentName:"td",href:"#GATEWAY_VALUE-JSON-Structure"},"JSON Structure"),". Can be omitted to default to empty.")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"INCOMING_TOPIC"),(0,l.kt)("td",{parentName:"tr",align:null},"Currently not used for Email")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"CONNECTION_ID"),(0,l.kt)("td",{parentName:"tr",align:null},"This should reference the connection ",(0,l.kt)("inlineCode",{parentName:"td"},"id")," specified in the ",(0,l.kt)("inlineCode",{parentName:"td"},"notify.kts")," file. Note: if the id is specified in the connection, then you should use the default id of ",(0,l.kt)("inlineCode",{parentName:"td"},"Email"))))),(0,l.kt)("h3",{id:"gateway_value-json-structure"},"GATEWAY_VALUE JSON structure"),(0,l.kt)("p",null,"Any of the ",(0,l.kt)("inlineCode",{parentName:"p"},"to"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"cc"),", or ",(0,l.kt)("inlineCode",{parentName:"p"},"bcc")," fields in the structure below can be omitted if they are empty arrays. "),(0,l.kt)("p",null,"If they are all empty, you can omit the entire ",(0,l.kt)("inlineCode",{parentName:"p"},"emailDistribution")," JSON object. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "emailDistribution": {\n    "to": ["jason <jason@email.com>", "carol@email.com>"],\n    "cc": ["susan@email.com", "Tom <tom@email.com>"],\n    "bcc": []\n  }\n} \n')),(0,l.kt)("p",null,"When you use ",(0,l.kt)("a",{parentName:"p",href:"/operations/commands/server-commands/#sendit-script"},(0,l.kt)("inlineCode",{parentName:"a"},"SendIt"))," to send data to the database, keep two things in mind:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"SendIt")," uses quotes to delimit strings. So, if there quotes within any string in your data, you need to escape them."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"SendIt")," interprets a new line as a new row in the database. So, make sure all the relevant data is on one single line - remove any unwanted line breaks.")),(0,l.kt)("p",null,"For example, here we are going to run ",(0,l.kt)("inlineCode",{parentName:"p"},"SendIt")," to send an empty distribution list to the database."),(0,l.kt)("p",null,"The command is:  ",(0,l.kt)("inlineCode",{parentName:"p"},"SendIt -t GATEWAY.CSV")),(0,l.kt)("p",null,"We have set up the data file GATEWAY.CSV in the following way."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-text"},'GATEWAY_ID,GATEWAY_TYPE,GATEWAY_VALUE,INCOMING_TOPIC\n"EMAIL1","EmailDistribution","{ \\"emailDistribution\\" : { \\"to\\" : [ ], \\"cc\\" : [ ], \\"bcc\\" : [ ] } }",\n')),(0,l.kt)("p",null,"The data is all on one single line. It has three strings, and the third string has four sets of quote marks, each of which we have escaped with a \\ character."),(0,l.kt)("h3",{id:"notify_route"},"NOTIFY_ROUTE"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Usage"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ENTITY_ID"),(0,l.kt)("td",{parentName:"tr",align:null},"Genesis User sending message, null implies System")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ENTITY_ID_TYPE"),(0,l.kt)("td",{parentName:"tr",align:null},'Enum of "USER_NAME", "PROFILE_NAME", "GATEWAY"')),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"TOPIC_MATCH"),(0,l.kt)("td",{parentName:"tr",align:null},"Topic that should match that will forward to the GATEWAY")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"GATEWAY_ID"),(0,l.kt)("td",{parentName:"tr",align:null},"The Gateway that matched topic messages will be sent to")))),(0,l.kt)("h3",{id:"notify"},"NOTIFY"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Usage"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"SENDER"),(0,l.kt)("td",{parentName:"tr",align:null},"Genesis User sending message, null implies System")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"TOPIC"),(0,l.kt)("td",{parentName:"tr",align:null},"The Topic to broadcast this message")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"BODY"),(0,l.kt)("td",{parentName:"tr",align:null},"Contents of message, for Email it should follow the ",(0,l.kt)("a",{parentName:"td",href:"#NOTIFY.BODY-JSON-Structure"},"JSON Structure"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"NOTIFY_COMPRESSION_TYPE"),(0,l.kt)("td",{parentName:"tr",align:null},"Used internally by Genesis, indicates if the body of the message is compressed")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"APPLICATION_REF"),(0,l.kt)("td",{parentName:"tr",align:null},"Currently not used for Email")))),(0,l.kt)("h3",{id:"notifybody-json-structure"},"NOTIFY.BODY JSON structure"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "emailDistribution": {\n    "to": ["jason <jason@email.com>", "carol@email.com>"],\n    "cc": ["susan@email.com", "Tom <tom@email.com>"],\n    "bcc": [],\n    "contents" : "Content of Message Here"\n  }\n} \n')),(0,l.kt)("p",null,"When sending HTML within the contents of a JSON string, you should escape any quotes, and remove or replace new lines."),(0,l.kt)("p",null,"Here is an example in Kotlin:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'htmlMailMessage.replaceAll("\\"", "&quot;").replaceAll("\\\\R", "\\\\\\\\n");\n')),(0,l.kt)("p",null,"The final outgoing emailDistribution will perform a merge of the distribution list specified on the Notify message and the statically defined distribution list specified for any Gateway which messages may be routed to."))}c.isMDXComponent=!0}}]);