---
sidebar_label: 'Server'
---

# The server envronment

:::danger WIP
Will edit this copy taken from the internal site.)
:::

## File structure
The  **~/run** directory is an important part of a Genesis application deployment. Recommended Genesis practice is to have dated run directories for each deployment. For any upgrade, you can then just symlink the `~/run` directory to the latest dated run directory. 

### symlinks
Symlinks are short cuts to other directories, similar to the short cuts you find on a Windows desktop. 

It makes it easy to roll back if things go wrong, simply by repointing to the old directory.

For example, the symlink below points run to a directory for an application called `foxtrot`, dated 18th May, 2021.


```
run-> data/foxtrot/20210518/run
```
### Folders
Now look at the the different folders you have.

#### genesis
This is the Genesis framework, containing all the libraries and config files.

#### generated
This contains all the installation-generated files (for example, cfg) following the most recent installation, upgrade or remap.

#### Modules
Within the run directory, you can find the key Genesis modules, each of which delivers important functions. Note two modules in particular:

* **AUTH**. This module is responsible for permissions – it contains access control lists that determine what information and functions each user has access to. In Genesis, Auth is used to control every single event. Therefore, it has been designed for high performance.
* **GCOM**. This contains all your libraries, scripts and the common data model (with standard definitions of fields and tables).

You can, of course, create and add your own modules.

The modules generated by the build all have a similar folder structure. The main items are:

* **scripts**. Utility scripts.
* **config**. Configuration files.
* **bin**. Contains the built .jar files (binary objects) for this module’s codebase.
* **lib**. Dependencies (libraries) for this module.

### site-specific
This is an area of the run directory where you can override the standard definitions found elsewhere in the application. You supply the standard definition name and your own definition. Your application will then only use your definition.

This is useful where you have used standard modules; you should never change these modules. Any files/definitions that are listed in the site-specific area automatically take their places. In the example below, our site-specific area has specific auth definitions including auth-dataserver.xml and 
auth-tables-dictionary.kts.

### runtime
runtime is used to store run-time information that is generated by the system. System logs and cache files are kept here.

For developers, it is good practice to create a folder within runtime when you need to pull or produce files that were generated from an external service.

:::danger WIP
(also from internal site - what you see when you do a mon. doesn't belong here - this is post genesisInstall - but need to fit it in. lots of dull table formatting here.)
:::

Here’s the scenario. You have just logged into a server and you have done a **sudo** to your new project. You then do a **mon** command to see what’s running.

What are all those processes? Here’s a very short explanation of the ones you are most likely to see

## Notification and Orchestration processes
The Notification & Orchestration Service runs automatically to connect all the components in the server.
Its job is to ensure that, every time an event occurs, every other process that has registered an interest is informed immediately. This enables the system to perform in real time. Therefore, the application itself does not require any coding for inter-process communications. 

This is a core microservice and the technology is Aeron.


| Process name | Task |
| --- | --- |
| GENESIS_CLUSTER | Automatically performs inter-process messaging. |    


## Security, Session and Permissions processes
Authentication and Authorisation (Auth) is a service that controls:

* whether users have access to the system (authentication)
* whether the user has the roght to see a specific item of information (authorisation)

Auth Permissions are set up and associated with a user role, not an individual. Visibility is controlled for every request (per UI object or other system), and also at a per-row level.

Permissions are stored in three summary tables in the NOSQL data store. This data is denormalised into a memory-mapped structure, so that action/query performance is extremely fast.

At log-in, user permission data is copied to the UI layer to control the data that the user is able to see.

Process name

Purpose

AUTH_MANAGER

Handles authentication of users, with links to Single Sign On (SSO) and Active Directory.

AUTH_PERMS

Handles permissions - whether the user has the right to view a specific piece of information. 

When the application starts, it checks every entity in the application and performs an authorisation check for every user on the system. In this way, it builds a map of permissioned users. 

AUTH_DATASERVER

Sends information on user rights to the User Interface, stored in the USER_RIGHTS table . 

AUTH_CONSOLIDATIONS

Provides data for authentication and authorisation. 

## Transaction and Event Handling processes
Everything in a Genesis application is driven by events. These could be incoming messages, changes to the database or a user clicking on a button.

Process name

Purpose

EVENT_HANDLER

Control the processing that takes place following each single events. For products that precede the development of EVENT_HANDLER, you might see TXN_HANDLER, which performs a similar function.

EVALUATOR

Details needed!!

## API and Data Distribution processes
The task of these processes is to provide data to the Web User Interface, and to ensure that each data item reaches the correct users (and nobody else).

Process name

Purpose

DATASERVER

Pushes real-time data to the user interface every time the database is updated.

REQUEST SERVER

Pushes static data to the user interface in response to specific events (for example, to populate a dialog in the user interface).

DATA PUBLISHER

Publishes lightweight real-time market-data changes. 

DB_SERVER

Details needed!!

GENESIS_ROUTER

Manages sessions and routes messages to/from services over tcp/ip, websockets, html, with encryption & compression. The data server uses this process to determine which users should receive each update. 

GENESIS_WEB_ADAPTER

If you are viewing an older instance, you might see this process. This is no longer used. It has been replaced by the GENESIS_ROUTER. 

## Data Persistence processes
These services ensure that database are kept on synch, and ensures that data is held in cache for fast access.

Process name

Purpose

GENESIS_TO_DB

Streams data from Genesis to a classic RDBMS database (such as Oracle or MSSQL). This process listens to changes in the Genesis tables (insert, modify and delete) and reproduces them in the selected RDBMS.

DB_TO_GENESIS

Streams data from a classic RDBMS database (such as Oracle or MSSQL) to a Genesis database. This process listens to changes in the SQL tables (insert, modify and delete) using a predefined system (triggers for each table to be streamed, procedures and a table to represent an update queue). It then reproduces them in the specified Genesis table.

GENESIS_SYNC

Synchronises two separate Genesis databases. Usually, this is used where  the distance is too great for clustering to be used.

## Data Analytics processes
Analytics provide aggregated and calculated data, such as real-time positions, chart data, or orders outstanding. Note that the analytic data is stored in the Genesis database, so access to the data is through request server or data server.

Process name

Purpose

CONSOLIDATOR

Aggregates data from the Genesis database in real time and  writes the new data in a separate data. 

R INTEGRATION

Enables consolidators to include R functions in their calculations. R is a statistical programming language.

## Integration processes
These processes enable Genesis applications to send messages to and receive messages from external systems. 

Process name

Purpose

CAMEL

Performs integration with external systems that produce or consume data.

FIX

integrates Genesis with external systems that use the FIX messaging standard.

MARKET DATA

Details needed!!

PROTOCOL_BUFFER

Details needed!!

STREAMER_SERVER

Listens to a table or view, and streams data out to streamer clients. In almost all cases, the table or view must be an audit table. This covers both inbound and outbound messages.

STREAMER_CLIENT

Receives data from a streamer server  When data is received, it transforms into the relevant format. This covers both inbound and outbound messages.

## Putting the pieces together
Below is an architectural overview that shows how these different processes and modules fit together.

:::danger WIP
(diagram at https://genesisglobal.atlassian.net/wiki/spaces/~162018992/pages/2500296705/What+are+all+these+processes.)
:::

The Web User Interface is at the top. The server is below, where you can see:

Security Session and Permission Services controlling access to data each time it is requested.

Notification and Orchestration Services connecting all the different processes with each other.

The Data Persistence Services are at the heart of of the server, ensuring that data is cached for fast and reliable access.

Integration Services are on the left and right sides, connecting the server to any relevant external systems.

Finally, note the Operational Control and Monitoring Services at the bottom. These are provided by GEM, Prometheus (monitoring and alerts) and Console.



 