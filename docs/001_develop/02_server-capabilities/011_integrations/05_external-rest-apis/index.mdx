---
title: 'External REST APIs'
sidebar_label: 'External REST APIs'
id: server-external-rest-apis
keywords: [server, external, rest, api, apis, integration, endpoints, web]
tags:
  - server
  - external
  - rest
  - api
  - apis
  - integration
  - endpoints
  - web
sidebar_position: 5
---

## Overview

The Genesis HTTP Client is designed to simplify integration with external REST services in the Genesis Platform. It provides an intuitive DSL for making HTTP requests, so that you can integrate [Request Server](/develop/server-capabilities/snapshot-queries-request-server/) and [Event Handler](/develop/server-capabilities/core-business-logic-event-handler/) with external applications easily and without the need to pull their data into your Genesis application. 

The key features and benefits are:

- **Seamless Integration**. Designed to work seamlessly with Genesis Request Servers and Event Handlers.
- **Flexible Usage**. Supports multiple approaches, including direct client usage, annotation-driven approach, and OpenAPI code generation.
- **Comprehensive HTTP Support**. Full support for GET, POST, PUT, DELETE.
- **Customizable**. Easily configure headers, query parameters, path parameters, and request bodies.
- **Error Handling**. Built-in support for retries and error callbacks.
- **Paginated Support**. Pagination support for Request Servers.

## Versions and compatibility
The Genesis HTTP Client was introduced in version 8.1 of the Genesis Platform. It is compatible with all Genesis applications running on version 8.1 or higher.

:::important
Ensure your Genesis Platform is updated to at least version 8.1 to use the Genesis HTTP Client.
:::

## Basic usage

Here's a quick example of a GET request using the Genesis HTTP Client within a Request Server:

```kotlin
requestReply<Unit, HelloWorld>("HELLO_WORLD") {
    val client = GenesisHttpClient()

    replySingle {
        client.get<HelloWorld> {
            url = "http://api.example.com/hello"
            query("name", "John")
        }.data
    }
}
```

This example demonstrates how to make a GET request within a Genesis Request Server, showcasing the client's seamless integration with Genesis components.
In the following sections, we'll explore the core concepts, different usage approaches, and advanced features of the Genesis HTTP Client.


## Example configuration

This section demonstrates practical examples of using the Genesis HTTP Client in common Genesis capabilities [Request Server](/develop/server-capabilities/snapshot-queries-request-server/) and [Event Handler](/develop/server-capabilities/core-business-logic-event-handler/) and common use cases.

### Example 1: Request Server with external API call

This example shows how to use the Genesis HTTP Client in a Request Server to fetch data from an external API:

```kotlin
requestReplies {
  requestReply<TradeRequest, TradeDetails>("FETCH_TRADE_DETAILS") {
    val client = GenesisHttpClient()

    replySingle { request: TradeRequest ->
      try {
        val response = client.get<TradeApiResponse> {
          url = "/trades/${request.tradeId}"
          query("currency", request.currency)
        }.data

        TradeDetails(
          id = response.data.id,
          amount = response.data.amount,
          currency = response.data.currency,
          status = response.data.status
        )
      } catch (e: UnexpectedResponseException) {
        when (e.statusCode) {
          HttpStatusCode.NotFound -> throw NotFoundException("Trade not found")
          else -> throw Exception("Error fetching trade: ${e.message}")
        }
      }
    }
  }
}
```

### Example 2: Event Handler with external POST

This example demonstrates how to use the Genesis HTTP Client in an Event Handler to send a post to an external service:

```kotlin
eventHandler {
  eventHandler<TradeEvent> {
    val client = GenesisHttpClient()

    data class TradeNotification(
      val tradeId: Long,
      val status: String,
      val timestamp: Long
    )

    onCommit { event ->
      val notification = TradeNotification(
        tradeId = event.tradeId,
        status = event.status,
        timestamp = event.timestamp
      )

      try {
        client.post<Unit>(
          path = "https://my-external-api/endpoint",
          request = notification,
          builder = {
            header("Authorization ", "Bearer 123")
          }
        )
        ack()
      } catch (e: Exception) {
        nack("Failed to send notification", e)
      }
    }
  }
}
```

### Example 3: Request Server with OpenAPI client

This example demonstrates how to use the OpenAPI-generated client service in a Request Server to get an account by id:

```kotlin

val tradeApiService = TradeApiService("http://localhost:8080")
tradeApiService.registerApiToken("Authorization", "Basic ABC123=")

requestReplies {
  requestReply<Int, Account>("GET_ACCOUNT_BY_ID") {
    replySingle {
      accountsApi.getAccountById(it.toLong())
    }
  }
}

```

### Example 4 - Request Server with OpenAPI client inside an Event Handler

This example demonstrates how to use the OpenAPI-generated client service in an Event Handler to update a trade in an external system via an external call. 

```kotlin

val tradeApiService = TradeApiService("http://localhost:8080")

eventHandler {
  eventHandler<TradeUpdateEvent> {
    onCommit { event ->
      val updatedTrade = NewTrade(
        symbol = event.symbol,
        quantity = event.quantity,
        price = event.price
      )

      try {
        tradeApiService.updateTrade(event.tradeId, updatedTrade)
        ack()
      } catch (e: Exception) {
        logger.error("Failed to update trade in external system: ${e.message}", e)
      }
    }
  }
}
```

### Example 5 - Paginated request

This example demonstrates how to integrate a Request Server which  a pagination supporting OpenAPI-generated REST API in an Event Handler using a paginated `requestReply`:

```kotlin

val accountsApi = AccountControllerApi("http://localhost:8080")
accountsApi.registerApiToken("Authorization", "Basic ABC123=")

requestReplies {
  requestReply<FindAllUsingGETRequest, AccountWithRecordId>("ACCOUNTS_API") {
    maxRetries = 5
    replyList { request ->
      try {
        val response = accountsApi.findAllUsingGET(request)
        val accounts = response.accounts.map { account ->
          AccountWithRecordId(
            account.accountNumber,
            account.balance,
            account.brokerId,
            account.customerId,
            account.owner
          )
        }
        accounts
      } catch (e: Exception) {
        LOG.warn("Error sending request for accounts to external API", e)
        emptyList()
      }
    }
  }
}
```

## Configuration options

TODO

## Client API

TODO

## Runtime configuration

The Genesis HTTP Client is available to use in Genesis applications running platform **version 8.1+**. 

To use it, add the following dependency to your project's `server/<your-app>/build.gradle.kts` file:

```kotlin {3}
dependencies {
  ...
  implementation("global.genesis:genesis-http-client")
}
```
