---
title: 'Real-time aggregation (Consolidator)'
sidebar_label: 'Real-time aggregation (Consolidator)'
id: server-real-time-aggregation-consolidator
keywords: [real time, real-time, aggregation, consolidator, consolidation]
tags:
- real time
- real-time
- aggregation
- consolidator
- consolidation
sidebar_position: 9
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import Log from '/snippet/_LOG.md'
import CommonProcesses from '/snippet/_common-see-processes.md'

## Overview

## Example configuration

## Configuration options

### Logging

<Log />

## Metrics

:::info
Ensure you have [enabled metrics](/build-deploy-operate/operate/metrics/#enabling-metrics) in your environment to view them.
:::

The consolidator exposes metrics to measure latency.

A high latency indicates that the consolidator is struggling to keep up.


| Metric                      | Explanation                          |
|:----------------------------|:-------------------------------------|
| calculation_latency         | latency for performing a calculation |
| consolidator_input_latency  | latency for processing an update     |
| consolidator_output_latency | latency for writing to database      |

## Runtime configuration

To include your `*-consolidator.kts` file definitions in a runtime process, you will need to ensure the process definition:

1. Ensure `genesis-pal-consolidator` is included in `module`
1. Ensure `global.genesis.pa.consolidator` is included in `package`
1. Ensure your consolidator.kts file(s) are defined in `script`
1. Ensure `pal` is set in `language`

If you wish to run a dedicated process for a request server, the following gives an example full process definition:

```kotlin
<process name="POSITION_CONSOLIDATOR">
  <groupId>POSITION</groupId>
  <description>Consolidates trades to calculate positions</description>
  <start>true</start>
  <options>-Xmx256m -DRedirectStreamsToLog=true -DXSD_VALIDATE=false -XX:MaxHeapFreeRatio=70 -XX:MinHeapFreeRatio=30 -XX:+UseG1GC -XX:+UseStringDeduplication -XX:OnOutOfMemoryError="handleOutOfMemoryError.sh %p"</options>
  <module>genesis-pal-consolidator</module>
  <package>global.genesis.pal.consolidator</package>
  <primaryOnly>true</primaryOnly>
  <script>position-consolidator.kts</script>
  <loggingLevel>DEBUG,DATADUMP_ON</loggingLevel>
  <language>pal</language>
</process>
```

:::important

In a multi-node environment, Consolidator services should be set to primary only; otherwise, the changes will be applied
multiple times.

:::

### `arguments`

In addition to the tags in the example, you can also add an `<arguments></arguments>` tag. This allows you to define process arguments that should be passed to the process on start-up.

It is helpful for consolidators where you wish your consolidator process to [`coldStart`](#coldstart) each time the process restarts

For example:

```kotlin{13}
<process name="POSITION_CONSOLIDATOR">
        <groupId>POSITION</groupId>
        <description>Consolidates trades to calculate positions</description>
        <start>true</start>
        <options>-Xmx256m -DRedirectStreamsToLog=true -DXSD_VALIDATE=false -XX:MaxHeapFreeRatio=70 -XX:MinHeapFreeRatio=30 -XX:+UseG1GC -XX:+UseStringDeduplication -XX:OnOutOfMemoryError="handleOutOfMemoryError.sh %p"</options>
        <module>genesis-pal-consolidator</module>
        <package>global.genesis.pal.consolidator</package>
        <primaryOnly>false</primaryOnly>
        <script>position-consolidator.kts</script>
        <loggingLevel>DEBUG,DATADUMP_ON</loggingLevel>
        <language>pal</language>
        <arguments>--coldStart</arguments>
    </process>
</process>
```

<CommonProcesses/>

## Testing
