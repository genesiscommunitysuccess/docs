---
title: 'Bloomberg API'
sidebar_label: 'Bloomberg API'
sidebar_position: 8
id: business-components-bloomberg
keywords: [Bloomberg, BBG, market data, market-data]
tags:
  - Bloomberg
  - BBG
  - market data
  - market-data
  - installation
  - genx
  - add
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Bloomberg API

## Overview

The Genesis Bloomberg module provides all the tools necesassary to easily connect to a Bloomberg API instance and consume data directly into your Genesis Application.

You can use the Bloomberg Connector directly in the [Data Pipelines](../../server-capabilities/integrations/data-pipelines/) integration framework to access Bloomberg data quickly and with minimal lines of code. 

Alternatively, you can use the Bloomberg Client directly in your custom code to have full control and more flexibility in how you consume data. In either scenario, our highly resilient and recoverable client will take care of the heavy lifting, meaning you can focus on the application's business logic.

## Adding Bloomberg to your Project

In order to use the capabilites of this module, you must add the following dependency to your application:

```kotlin
implementation("global.genesis:bloomberg-genesis:${properties["genesisIntegrationVersion"]}")
```

You can also use the genx CLI to add dependencies and configuration files manually.

<Tabs
    defaultValue="windows"
    values={[
        { label: 'Windows', value: 'windows', },
        { label: 'Mac and Linux', value: 'mac-and-linux', }
    ]
    }>
    <TabItem value="windows">
        ```shell title="Powershell"
        npx -y @genesislcap/genx@latest add app-folder-name -x -s genesislcap/bloomberg-genesis-seed
        ```
    </TabItem>

    <TabItem value= 'mac-and-linux'>
        ```shell title="Bash"
        npx -y @genesislcap/genx@latest add app-folder-name -x -s genesislcap/bloomberg-genesis-seed
        ```
    </TabItem>
</Tabs>

## Consuming Data

### Common Configuration
Both the direct and Data Pipelines approaches both use a common configuration structure in GPAL, which offers auto-complete and type-safe configuration for initialising a Bloomberg client.

```kotlin
bloomberg {
  addServer(hostName = "localhost", port = 8194)
  applicationName = "Genesis:Demo Application"
  pathToPk7 = "./src/test/resources/rootCert.pk7"
  pathToPk12 = "./src/test/resources/cert.pk12"
  pkPassword = "********"
  defaultSubscriptionService = "//blp/mktdata"
  clientName = "BloombergClient"
  numberOfStartAttempts = 10
  reconnectionDelayMillis = 10000L
  enableEntitlementChecks = true
  wrapData = true
}
```

The `addServer` function allows you to add multiple IP address / port combinations that the client will use to connect. Each function will add a server to the underlying array, and the client will connect in a round-robin fashion. The port is optional, and will default to 8194.

The other configuration options are as follows:
 - applicationName (required): This is the identifier for the application. When the client connects, it will first authenticate the application before requesting data. This value will be set up on the Bloomberg remote server as part of onboarding.
 - pathToPk7 (optional): If you are using a Bloomberg cloud hosted B-PIPE instance, also referred to as 'zero footprint', a set of certificates and a password will be provided to you in order to secure the connection.
 - pathToPk12 (optional): See `pathToPk7`.
 - pkPassword (optional): See `pathToPk7`.
 - defaultSubscriptionService (required): The identifier for the Bloomberg service to send subscriptions to. See Bloomberg Developer documentation for a full list of services.
 - clientName (optional): The name of the client as referred to by process monitoring and healthchecks. Defaults to 'BloombergClient'. Please change this if you want more granularity of monitoring on different client instances within your application.
 - numberOfStartAttempts (optional): The number of connection attempts to make to the remote server. This is a direct configuration option on the Bloomberg API library, when this number has been exhausted, the Genesis Client will wait for the reconnection delay and then restart the session. Defaults to 10.
 - reconnectionDelayMillis (optional): The time in milliseconds to wait before attempting to recreate and restart the session connection to Bloomberg. This is a configuration item of the Genesis client, not the underlying library. While the Genesis client is running, it will continually attempt to connect.
 - enableEntitlementChecks (optional): Boolean flag indicating whether the client should emit events detailing user entitlement changes to the Application. If consuming data from a service that requires EID checking, the application MUST correctly handle these events in order to enforce Bloomberg EMRS entitlements and pass certification.
 - wrapData (optional): Boolean flag indicating whether data points should be wrapped in a DataField wrapper class, that supports interrogation for data type information. Defaults to true. Wrapping the data makes writing the consumer logic easier, at the cost of additional memory overhead in the application. For applications with a large number of topic subscriptions, or requirements to handle a large number of updates, it may be prudent to set this to false.



### Using the Client Directly
In order to use the Bloomberg client directly in your code, you can inject it via [dependency injection](../../server-capabilities/custom-components/#injecting-dependencies). The client will attempt to find a file matching the pattern `*-bloomberg.kts` included as part of the process definition, and use this to initialise the client automatically.

<Tabs
    defaultValue="Java"
    values={[
        { label: 'Java', value: 'Java', },
        { label: 'Kotlin', value: 'Kotlin', }
    ]
    }>
    <TabItem value="Java">
    ```Java
    import javax.inject.Inject;

    public class BloombergSubscriber {
      private BloombergClient client;
    
      @Inject
      public BloombergSubscriber(BloombergClient client) {
        this.client = client;
      }
    }
    ```
    </TabItem>

    <TabItem value= 'Kotlin'>
    ```kotlin
    import javax.inject.Inject

    class BloombergSubscriber @Inject constructor(
      private val client: BloombergClient
    )
    ```
    </TabItem>
</Tabs>


### Using Data Pipelines

The Genesis Bloomberg module also allows direct integration with [Data Pipelines](../../server-capabilities/integrations/data-pipelines/). In order to create an instance of the `BloombergGateway`, which acts as both a source of Events, and a Sink for requests, you can use the `bloomberg` GPAL extension.

```kotlin
pipelines {

    val bloomberg = bloomberg {
        addServer("localhost", 8194)
        applicationName = "TestApp"
        pathToPk7 = "/certs/root.pk7"
        pathToPk12 = "certs/cert.pk12"
        pkPassword = "***********"
        defaultSubscriptionService = "//blp/mktdata"
    }

    pipeline(name = "Bloomberg Subscriptions") {
        source(dbBulkSubscribe<Instruments>())
            .map { element ->
              // Convert instrument to DataSubscription here
            }
            .sink(bloomberg)
    }

    pipeline(name = "Bloomberg Data Updates") {
        source(bloomberg)
            .map { element ->
              // Convert Data Update to market data record here
            }
            .sink(dbSink())
    }
}
```

In addition to the configuration properties detailed [above](./#common-configuration), the Gateway configuration also exposes additional config options:
 - pipelineBufferSize (optional): The number of elements to buffer while they are waiting to be consumed by the sink. Defaults to 1000. Note that only data updates will be discarded. User entitlement updates will not be discarded and the buffer will have to clear before they can be processed.

## Client API

### Requests
Requests are sent to Bloomberg. They have a common supertype, `BloombergRequest`, that is the input type supported by the Bloomberg Sink in Data Pipelines. Sending a request is how you interact with the Bloomberg client.

##### DataSubscription
The DataSubscription contains the information required to subscribe to a real time data feed from a Bloomberg API service. It contains the following pieces of information:
 - correlationId (String): A unique identifier for the subscription
 - topic (String): An identifier for the feed to subscribe to. For example, when using the market data service (//blp/mktdata) as the default subscription service, the topic should be the Bloomberg Instrument Ticker (VOD LN Equity).
 - fields (List of String): A list of valid Bloomberg field identifiers (FIDs) that you want to subscribe for. Please see Bloomberg Developer Documentation for more details on which FIDs are available per service.
 - options (List of String) : A list of additional options, such as the update frequency, or whether to subscribe for delayed data.

##### DataUnsubscribe
The DataSubscription contains the information required to unsubscribe from a previously registered subscription. It contains the following pieces of information:
 - correlationId (String): A unique identifier for the subscription

##### DataRequest
The DataRequest represents a one-off request for data sent to a Bloomberg API service. Most services either support real-time subscriptions, or one-off data requests. It contains the following pieces of information:
 - correlationId (String): A unique identifier for the request
 - topic (String): An identifier for the feed to request data for. For example, when using the product data service (//blp/refdata) as the default subscription service, the topic should be the Bloomberg Instrument Ticker (VOD LN Equity).
 - fields (List of String): A list of valid Bloomberg field identifiers (FIDs) that you want to receiver data for. Please see Bloomberg Developer Documentation for more details on which FIDs are available per service.
 - requestType (String) : The type of request you want to send to the service. For example, `ReferenceDataRequest`.

##### UserLogon
The UserLogon request triggers an authentication check for a particular user with Bloomberg EMRS, and starts a flow of entitlement events for every user that is successfully authenticated. It contains the following pieces of information:
 - userName (String): The identifier of the user account within the Genesis Application.
 - emrsId (String): The identifier of the user as they are known to the Bloomberg entitlement system (EMRS)
 - ipAddress (String): The IP address from which the user is currently logged into the Genesis Application.

### Events
Events are received from Bloomberg. They have a common supertype, `BloombergEvent`, that is the output type supported by the Bloomberg Source in Data Pipelines. Receiving and processing events is how you consume data from Bloomberg.

#### Registering an Event Listener

##### SubscriptionDataEvent

##### SubscriptionRawDataEvent

##### DataResponseEvent

##### SubscriptionStatusEvent

##### UserEntitlementsUpdateEvent

##### UserEntitlementsRevokedEvent

## Examples
For a real-world example of how to build an application that consumes Bloomberg Market Data, please see our how-to guide. 
TODO link